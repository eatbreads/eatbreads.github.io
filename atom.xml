<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ¬¢è¿æ¥åˆ°å°é¢åŒ…çš„å°ç«™ğŸ¥</title>
  
  
  <link href="https://eatbreads.github.io/atom.xml" rel="self"/>
  
  <link href="https://eatbreads.github.io/"/>
  <updated>2025-05-22T02:41:18.065Z</updated>
  <id>https://eatbreads.github.io/</id>
  
  <author>
    <name>å°é¢åŒ…ğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>leetcodeåˆ·é¢˜-æ»‘åŠ¨çª—å£-3-438</title>
    <link href="https://eatbreads.github.io/posts/9e2906b8.html"/>
    <id>https://eatbreads.github.io/posts/9e2906b8.html</id>
    <published>2025-05-22T02:41:18.000Z</published>
    <updated>2025-05-22T02:41:18.065Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>LeetCodeå­ä¸²é—®é¢˜ç»å…¸é¢˜ç›®è§£æ</title>
    <link href="https://eatbreads.github.io/posts/fc21f42c.html"/>
    <id>https://eatbreads.github.io/posts/fc21f42c.html</id>
    <published>2025-05-22T02:39:24.000Z</published>
    <updated>2025-05-23T15:55:45.460Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LeetCodeå­ä¸²é—®é¢˜ç»å…¸é¢˜ç›®è§£æ"><a href="#LeetCodeå­ä¸²é—®é¢˜ç»å…¸é¢˜ç›®è§£æ" class="headerlink" title="LeetCodeå­ä¸²é—®é¢˜ç»å…¸é¢˜ç›®è§£æ"></a>LeetCodeå­ä¸²é—®é¢˜ç»å…¸é¢˜ç›®è§£æ</h1><h2 id="560-å’Œä¸ºkçš„å­æ•°ç»„"><a href="#560-å’Œä¸ºkçš„å­æ•°ç»„" class="headerlink" title="560. å’Œä¸ºkçš„å­æ•°ç»„"></a>560. å’Œä¸ºkçš„å­æ•°ç»„</h2><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><ul><li>ä½¿ç”¨å‰ç¼€å’Œ + å“ˆå¸Œè¡¨ä¼˜åŒ–</li><li>å­æ•°ç»„å’Œå¯ä»¥è¡¨ç¤ºä¸ºä¸¤ä¸ªå‰ç¼€å’Œä¹‹å·®</li><li>ä¸€è¾¹è®¡ç®—å‰ç¼€å’Œä¸€è¾¹è®°å½•åˆ°å“ˆå¸Œè¡¨</li><li>æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ presum-k çš„å‰ç¼€å’Œ </li></ul><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">subarraySum</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; mp;</span><br><span class="line">        mp[<span class="number">0</span>]=<span class="number">1</span>;  <span class="comment">//å¤„ç†ç©ºæ•°ç»„çš„æƒ…å†µ</span></span><br><span class="line">        <span class="type">int</span> r=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> presum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;nums.<span class="built_in">size</span>();i++) &#123;</span><br><span class="line">            presum +=nums[i];</span><br><span class="line">            r+=mp[presum-k];</span><br><span class="line">            mp[presum]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a>239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼</h2><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><ul><li>ä½¿ç”¨å“ˆå¸Œè¡¨è®°å½•å…ƒç´ å‡ºç°æ¬¡æ•°</li><li>ä½¿ç”¨æœ€å¤§å †ç»´æŠ¤å½“å‰çª—å£æœ€å¤§å€¼</li><li>ç§»åŠ¨çª—å£æ—¶ï¼š<ol><li>æ–°å…ƒç´ åŠ å…¥å †å’Œå“ˆå¸Œè¡¨</li><li>åˆ é™¤å…ƒç´ ä»å“ˆå¸Œè¡¨ç§»é™¤</li><li>å †é¡¶å…ƒç´ ä¸åœ¨å“ˆå¸Œè¡¨ä¸­æ—¶å¼¹å‡º</li></ol></li></ul><h3 id="ä»£ç å®ç°-1"><a href="#ä»£ç å®ç°-1" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">maxSlidingWindow</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> cmp = [](<span class="type">int</span> left, <span class="type">int</span> right) &#123; <span class="keyword">return</span> left &lt; right; &#125;;</span><br><span class="line">        priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, <span class="keyword">decltype</span>(cmp)&gt; <span class="built_in">maxHeap</span>(cmp);</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; count;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; result;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–çª—å£</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            maxHeap.<span class="built_in">push</span>(nums[i]);</span><br><span class="line">            count[nums[i]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        result.<span class="built_in">push_back</span>(maxHeap.<span class="built_in">top</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ»‘åŠ¨çª—å£</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = k; i &lt; nums.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            count[nums[i-k]]--;</span><br><span class="line">            count[nums[i]]++;</span><br><span class="line">            maxHeap.<span class="built_in">push</span>(nums[i]);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ç§»é™¤å †é¡¶æ— æ•ˆå…ƒç´ </span></span><br><span class="line">            <span class="keyword">while</span>(!count[maxHeap.<span class="built_in">top</span>()]) &#123;</span><br><span class="line">                maxHeap.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            result.<span class="built_in">push_back</span>(maxHeap.<span class="built_in">top</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="76-æœ€å°è¦†ç›–å­ä¸²"><a href="#76-æœ€å°è¦†ç›–å­ä¸²" class="headerlink" title="76. æœ€å°è¦†ç›–å­ä¸²"></a>76. æœ€å°è¦†ç›–å­ä¸²</h2><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><ul><li>ä½¿ç”¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼š<ol><li>è®°å½•ç›®æ ‡å­—ç¬¦ä¸²ä¸­å­—ç¬¦å‡ºç°æ¬¡æ•°</li><li>è®°å½•å½“å‰çª—å£ä¸­å­—ç¬¦å‡ºç°æ¬¡æ•°</li></ol></li><li>ä½¿ç”¨æ»‘åŠ¨çª—å£ï¼š<ol><li>å³æŒ‡é’ˆæ‰©å±•ç›´åˆ°åŒ…å«æ‰€æœ‰ç›®æ ‡å­—ç¬¦</li><li>å·¦æŒ‡é’ˆæ”¶ç¼©ä¼˜åŒ–é•¿åº¦</li><li>ç»´æŠ¤æœ€å°è¦†ç›–å­ä¸²</li></ol></li></ul><h3 id="ä»£ç å®ç°-2"><a href="#ä»£ç å®ç°-2" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">minWindow</span><span class="params">(string s, string t)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">char</span>, <span class="type">int</span>&gt; need, window;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c : t) need[c]++;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> left = <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> valid = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> start = <span class="number">0</span>, len = INT_MAX;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(right &lt; s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="type">char</span> c = s[right];</span><br><span class="line">            right++;</span><br><span class="line">            <span class="keyword">if</span>(need.<span class="built_in">count</span>(c)) &#123;</span><br><span class="line">                window[c]++;</span><br><span class="line">                <span class="keyword">if</span>(window[c] == need[c]) valid++;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span>(valid == need.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                <span class="keyword">if</span>(right - left &lt; len) &#123;</span><br><span class="line">                    start = left;</span><br><span class="line">                    len = right - left;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">char</span> d = s[left];</span><br><span class="line">                left++;</span><br><span class="line">                <span class="keyword">if</span>(need.<span class="built_in">count</span>(d)) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(window[d] == need[d]) valid--;</span><br><span class="line">                    window[d]--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> len == INT_MAX ? <span class="string">&quot;&quot;</span> : s.<span class="built_in">substr</span>(start, len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å­ä¸²é—®é¢˜çš„æ ¸å¿ƒæŠ€å·§ï¼š</p><ol><li>å‰ç¼€å’Œ + å“ˆå¸Œè¡¨ä¼˜åŒ–</li><li>æ»‘åŠ¨çª—å£ + æ•°æ®ç»“æ„ç»´æŠ¤</li><li>åŒæŒ‡é’ˆ + çŠ¶æ€è®°å½•</li></ol><p>å¸¸è§ä¼˜åŒ–æ–¹å‘ï¼š</p><ul><li>ç©ºé—´æ¢æ—¶é—´</li><li>åˆç†ä½¿ç”¨æ•°æ®ç»“æ„</li><li>åŒæŒ‡é’ˆå‡å°‘éå†æ¬¡æ•°</li></ul>]]></content>
    
    
    <summary type="html">è¯¦ç»†åˆ†æLeetCodeä¸­çš„ç»å…¸å­ä¸²é—®é¢˜ï¼ŒåŒ…æ‹¬å’Œä¸ºkçš„å­æ•°ç»„ã€æ»‘åŠ¨çª—å£æœ€å¤§å€¼å’Œæœ€å°è¦†ç›–å­ä¸²</summary>
    
    
    
    <category term="ç®—æ³•é¢˜è§£" scheme="https://eatbreads.github.io/categories/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
    
    <category term="LeetCode" scheme="https://eatbreads.github.io/tags/LeetCode/"/>
    
    <category term="ç®—æ³•" scheme="https://eatbreads.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="å­ä¸²" scheme="https://eatbreads.github.io/tags/%E5%AD%90%E4%B8%B2/"/>
    
  </entry>
  
  <entry>
    <title>Webæ¡†æ¶ä¸šåŠ¡å±‚è®¾è®¡ä¸å®ç°</title>
    <link href="https://eatbreads.github.io/posts/e75990a.html"/>
    <id>https://eatbreads.github.io/posts/e75990a.html</id>
    <published>2025-05-22T02:34:25.000Z</published>
    <updated>2025-05-22T02:37:41.930Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Webæ¡†æ¶ä¸šåŠ¡å±‚è®¾è®¡ä¸å®ç°"><a href="#Webæ¡†æ¶ä¸šåŠ¡å±‚è®¾è®¡ä¸å®ç°" class="headerlink" title="Webæ¡†æ¶ä¸šåŠ¡å±‚è®¾è®¡ä¸å®ç°"></a>Webæ¡†æ¶ä¸šåŠ¡å±‚è®¾è®¡ä¸å®ç°</h1><h2 id="æ¨¡å—æ¦‚è¿°"><a href="#æ¨¡å—æ¦‚è¿°" class="headerlink" title="æ¨¡å—æ¦‚è¿°"></a>æ¨¡å—æ¦‚è¿°</h2><p>è¿™æ˜¯ä¸€ä¸ªè½»é‡çº§ä½†åŠŸèƒ½å®Œæ•´çš„Web MVCæ¡†æ¶ï¼Œæ”¯æŒå¸¸è§çš„Webåº”ç”¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬è·¯ç”±ã€æ§åˆ¶å™¨ã€è¯·æ±‚å¤„ç†ã€å“åº”ç”Ÿæˆç­‰ã€‚é€šè¿‡åå°„æœºåˆ¶å®ç°äº†ä¼˜é›…çš„æ§åˆ¶å™¨æ³¨å†Œå’Œæ–¹æ³•è°ƒç”¨ã€‚</p><h2 id="ç±»ç»“æ„è®¾è®¡"><a href="#ç±»ç»“æ„è®¾è®¡" class="headerlink" title="ç±»ç»“æ„è®¾è®¡"></a>ç±»ç»“æ„è®¾è®¡</h2><h3 id="1-Requestç±»"><a href="#1-Requestç±»" class="headerlink" title="1. Requestç±»"></a>1. Requestç±»</h3><p>å¤„ç†HTTPè¯·æ±‚ï¼š<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string m_method;        <span class="comment">// è¯·æ±‚æ–¹æ³•(GET/POST)</span></span><br><span class="line">    string m_uri;          <span class="comment">// å®Œæ•´URI</span></span><br><span class="line">    string m_path;         <span class="comment">// è¯·æ±‚è·¯å¾„</span></span><br><span class="line">    string m_body;         <span class="comment">// è¯·æ±‚ä½“</span></span><br><span class="line">    Json m_post;          <span class="comment">// POSTæ•°æ®</span></span><br><span class="line">    std::map&lt;string, FileUpload&gt; m_files;  <span class="comment">// ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3 id="2-Responseç±»"><a href="#2-Responseç±»" class="headerlink" title="2. Responseç±»"></a>2. Responseç±»</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Response</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">html</span><span class="params">(<span class="type">const</span> string &amp; data)</span></span>;    <span class="comment">// è¿”å›HTML</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">json</span><span class="params">(<span class="type">const</span> string &amp; data)</span></span>;    <span class="comment">// è¿”å›JSON</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">render</span><span class="params">(<span class="type">const</span> string &amp; filename)</span></span>; <span class="comment">// æ¸²æŸ“æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> m_code;     <span class="comment">// çŠ¶æ€ç </span></span><br><span class="line">    Type m_type;    <span class="comment">// å“åº”ç±»å‹</span></span><br><span class="line">    string m_data;  <span class="comment">// å“åº”æ•°æ®</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="3-Serverç±»"><a href="#3-Serverç±»" class="headerlink" title="3. Serverç±»"></a>3. Serverç±»</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">()</span></span>;  <span class="comment">// å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bind</span><span class="params">(<span class="type">const</span> string &amp; path, server_handler handler)</span></span>; <span class="comment">// è·¯ç”±ç»‘å®š</span></span><br><span class="line">    <span class="function">string <span class="title">handle</span><span class="params">(<span class="type">const</span> Request &amp; req)</span></span>; <span class="comment">// è¯·æ±‚å¤„ç†</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::map&lt;string, server_handler&gt; m_handlers; <span class="comment">// è·¯ç”±è¡¨</span></span><br><span class="line">    string m_template_folder;  <span class="comment">// æ¨¡æ¿ç›®å½•</span></span><br><span class="line">    string m_static_folder;   <span class="comment">// é™æ€æ–‡ä»¶ç›®å½•</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="4-æ§åˆ¶å™¨ç¤ºä¾‹"><a href="#4-æ§åˆ¶å™¨ç¤ºä¾‹" class="headerlink" title="4. æ§åˆ¶å™¨ç¤ºä¾‹"></a>4. æ§åˆ¶å™¨ç¤ºä¾‹</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Form</span> : <span class="keyword">public</span> Controller &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">index</span><span class="params">(<span class="type">const</span> Request &amp; req, Response &amp; resp)</span></span>;  <span class="comment">// æ¸²æŸ“è¡¨å•é¡µé¢</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">reply</span><span class="params">(<span class="type">const</span> Request &amp; req, Response &amp; resp)</span></span>;  <span class="comment">// å¤„ç†è¡¨å•æäº¤</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç»§æ‰¿äºControllerå°±å®ç°äº†/Form/replyçš„è·¯ç”±æ³¨å†Œ</p><h2 id="å¸¸è§é—®é¢˜è§£ç­”-Q-amp-A"><a href="#å¸¸è§é—®é¢˜è§£ç­”-Q-amp-A" class="headerlink" title="å¸¸è§é—®é¢˜è§£ç­”(Q&amp;A)"></a>å¸¸è§é—®é¢˜è§£ç­”(Q&amp;A)</h2><h3 id="Q1-è¯·æè¿°è¯¥Webæ¡†æ¶çš„æ•´ä½“æ¶æ„è®¾è®¡å’Œä¸»è¦ç»„ä»¶ï¼Ÿ"><a href="#Q1-è¯·æè¿°è¯¥Webæ¡†æ¶çš„æ•´ä½“æ¶æ„è®¾è®¡å’Œä¸»è¦ç»„ä»¶ï¼Ÿ" class="headerlink" title="Q1: è¯·æè¿°è¯¥Webæ¡†æ¶çš„æ•´ä½“æ¶æ„è®¾è®¡å’Œä¸»è¦ç»„ä»¶ï¼Ÿ"></a>Q1: è¯·æè¿°è¯¥Webæ¡†æ¶çš„æ•´ä½“æ¶æ„è®¾è®¡å’Œä¸»è¦ç»„ä»¶ï¼Ÿ</h3><p>A1: æ¡†æ¶ä¸»è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š</p><ol><li><p>Serverç»„ä»¶</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">()</span></span>;                     <span class="comment">// å¯åŠ¨æœåŠ¡å™¨</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bind</span><span class="params">(<span class="type">const</span> string &amp; path, server_handler handler)</span></span>;  <span class="comment">// è·¯ç”±ç»‘å®š</span></span><br><span class="line">    <span class="function">string <span class="title">handle</span><span class="params">(<span class="type">const</span> Request &amp; req)</span></span>;  <span class="comment">// è¯·æ±‚å¤„ç†</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::map&lt;string, server_handler&gt; m_handlers;  <span class="comment">// è·¯ç”±è¡¨</span></span><br><span class="line">    string m_template_folder;  <span class="comment">// æ¨¡æ¿ç›®å½•</span></span><br><span class="line">    string m_static_folder;   <span class="comment">// é™æ€èµ„æºç›®å½•</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>è¯·æ±‚å¤„ç†æµç¨‹ï¼š</p></li></ol><ul><li>URLè§£æ</li><li>è·¯ç”±åŒ¹é…</li><li>æ§åˆ¶å™¨è°ƒç”¨</li><li>å“åº”ç”Ÿæˆ</li></ul><h3 id="Q2-æ¡†æ¶å¦‚ä½•å¤„ç†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Ÿ"><a href="#Q2-æ¡†æ¶å¦‚ä½•å¤„ç†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Ÿ" class="headerlink" title="Q2: æ¡†æ¶å¦‚ä½•å¤„ç†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Ÿ"></a>Q2: æ¡†æ¶å¦‚ä½•å¤„ç†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Ÿ</h3><p>A2: ä¸»è¦é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°ï¼š</p><ol><li><p>FileUploadç±»ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FileUpload</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">parse</span><span class="params">(<span class="type">const</span> <span class="type">char</span> * buf, <span class="type">int</span> len)</span></span>;  <span class="comment">// è§£æä¸Šä¼ æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">save</span><span class="params">(<span class="type">const</span> string &amp; filename)</span></span>;      <span class="comment">// ä¿å­˜æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string m_name;      <span class="comment">// è¡¨å•å­—æ®µå</span></span><br><span class="line">    string m_filename;  <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">    string m_type;      <span class="comment">// æ–‡ä»¶ç±»å‹</span></span><br><span class="line">&#125;; </span><br></pre></td></tr></table></figure></li><li><p>å¤„ç†æµç¨‹ï¼š</p></li></ol><ul><li>è§£æmultipart/form-data</li><li>æå–æ–‡ä»¶ä¿¡æ¯å’Œå†…å®¹</li><li>ä¿å­˜åˆ°æŒ‡å®šç›®å½•</li></ul><h3 id="Q3-æ¡†æ¶æ”¯æŒå“ªäº›å“åº”ç±»å‹ï¼Ÿå¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„å“åº”ï¼Ÿ"><a href="#Q3-æ¡†æ¶æ”¯æŒå“ªäº›å“åº”ç±»å‹ï¼Ÿå¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„å“åº”ï¼Ÿ" class="headerlink" title="Q3: æ¡†æ¶æ”¯æŒå“ªäº›å“åº”ç±»å‹ï¼Ÿå¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„å“åº”ï¼Ÿ"></a>Q3: æ¡†æ¶æ”¯æŒå“ªäº›å“åº”ç±»å‹ï¼Ÿå¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„å“åº”ï¼Ÿ</h3><p>A3: æ”¯æŒå¤šç§å“åº”ç±»å‹ï¼š</p><ol><li>Responseç±»å‹æšä¸¾ï¼š</li></ol><ul><li>HTML</li><li>JSON</li><li>JS</li><li>CSS</li><li>å›¾ç‰‡(JPG/PNG/GIF)</li><li>ICO</li></ul><ol><li>å“åº”å¤„ç†ç¤ºä¾‹ï¼š<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Response::data</span><span class="params">(Type type, <span class="type">const</span> string &amp; data)</span> </span>&#123;</span><br><span class="line">    m_type = type;</span><br><span class="line">    m_data = data;</span><br><span class="line">    <span class="comment">// æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒçš„Content-Type</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="Q4-è¯·è¯¦ç»†æè¿°æ¡†æ¶çš„è·¯ç”±å®ç°æœºåˆ¶ï¼Ÿ"><a href="#Q4-è¯·è¯¦ç»†æè¿°æ¡†æ¶çš„è·¯ç”±å®ç°æœºåˆ¶ï¼Ÿ" class="headerlink" title="Q4: è¯·è¯¦ç»†æè¿°æ¡†æ¶çš„è·¯ç”±å®ç°æœºåˆ¶ï¼Ÿ"></a>Q4: è¯·è¯¦ç»†æè¿°æ¡†æ¶çš„è·¯ç”±å®ç°æœºåˆ¶ï¼Ÿ</h3><p>A4: è·¯ç”±å®ç°åŒ…å«ï¼š</p><ol><li><p>URLè§£æï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;string&gt; arr = String::<span class="built_in">split</span>(String::<span class="built_in">trim</span>(path, <span class="string">&quot; /&quot;</span>), <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line"><span class="comment">// è§£æä¸ºæ§åˆ¶å™¨åå’Œæ–¹æ³•å</span></span><br></pre></td></tr></table></figure></li><li><p>è·¯ç”±åŒ¹é…ä¼˜å…ˆçº§ï¼š</p></li></ol><ul><li>æ˜¾å¼è·¯ç”±ç»‘å®š</li><li>é™æ€èµ„æºåŒ¹é…</li><li>æ§åˆ¶å™¨æ–¹æ³•æ˜ å°„</li></ul><ol><li>åå°„è°ƒç”¨ï¼š<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object * ctrl = factory-&gt;<span class="built_in">create_class</span>(classname);</span><br><span class="line">ctrl-&gt;<span class="built_in">call</span>(methodname, req, resp);</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»Webæ¡†æ¶ä¸šåŠ¡å±‚çš„è®¾è®¡å®ç°ï¼ŒåŒ…æ‹¬è¯·æ±‚å¤„ç†ã€è·¯ç”±ã€æ§åˆ¶å™¨ç­‰æ ¸å¿ƒåŠŸèƒ½</summary>
    
    
    
    <category term="ç³»ç»Ÿè®¾è®¡" scheme="https://eatbreads.github.io/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="C++" scheme="https://eatbreads.github.io/tags/C/"/>
    
    <category term="Webæ¡†æ¶" scheme="https://eatbreads.github.io/tags/Web%E6%A1%86%E6%9E%B6/"/>
    
    <category term="MVC" scheme="https://eatbreads.github.io/tags/MVC/"/>
    
  </entry>
  
  <entry>
    <title>Webæ¡†æ¶åå°„æ¨¡å—è®¾è®¡ä¸å®ç°</title>
    <link href="https://eatbreads.github.io/posts/451bf76a.html"/>
    <id>https://eatbreads.github.io/posts/451bf76a.html</id>
    <published>2025-05-22T02:30:39.000Z</published>
    <updated>2025-05-22T02:33:40.822Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Webæ¡†æ¶åå°„æ¨¡å—è®¾è®¡ä¸å®ç°"><a href="#Webæ¡†æ¶åå°„æ¨¡å—è®¾è®¡ä¸å®ç°" class="headerlink" title="Webæ¡†æ¶åå°„æ¨¡å—è®¾è®¡ä¸å®ç°"></a>Webæ¡†æ¶åå°„æ¨¡å—è®¾è®¡ä¸å®ç°</h1><h2 id="æ¨¡å—æ¦‚è¿°"><a href="#æ¨¡å—æ¦‚è¿°" class="headerlink" title="æ¨¡å—æ¦‚è¿°"></a>æ¨¡å—æ¦‚è¿°</h2><p>è¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„C++åå°„åº“ï¼Œä½äº <code>reflect</code> ç›®å½•ä¸‹ã€‚ä¸»è¦å®ç°äº†ç±»ã€æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°çš„åå°„æœºåˆ¶ï¼Œæ”¯æŒè¿è¡Œæ—¶çš„åŠ¨æ€åˆ›å»ºå¯¹è±¡ã€è®¿é—®å±æ€§å’Œè°ƒç”¨æ–¹æ³•ã€‚</p><h3 id="ä¸»è¦ç‰¹æ€§"><a href="#ä¸»è¦ç‰¹æ€§" class="headerlink" title="ä¸»è¦ç‰¹æ€§"></a>ä¸»è¦ç‰¹æ€§</h3><ul><li>æ”¯æŒç±»çš„åŠ¨æ€åˆ›å»ºå’Œç®¡ç†</li><li>æ”¯æŒæˆå‘˜å˜é‡çš„åŠ¨æ€è®¿é—®å’Œä¿®æ”¹</li><li>æ”¯æŒæˆå‘˜å‡½æ•°çš„åŠ¨æ€è°ƒç”¨</li><li>ä½¿ç”¨å®ç®€åŒ–åå°„æ³¨å†Œè¿‡ç¨‹</li><li>çº¿ç¨‹å®‰å…¨çš„å•ä¾‹å·¥å‚æ¨¡å¼</li></ul><p>è¿™ä¸ªåå°„åº“è®¾è®¡ç²¾å·§ï¼Œé€šè¿‡å·§å¦™è¿ç”¨æ¨¡æ¿ã€å®å’ŒæŒ‡é’ˆåç§»ç­‰æŠ€æœ¯ï¼Œå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„åå°„ç³»ç»Ÿã€‚å®ƒçš„ä½¿ç”¨æ–¹å¼ç®€å•ï¼Œæ€§èƒ½å¼€é”€å°ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è½»é‡çº§åå°„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="ç±»ç»“æ„è®¾è®¡"><a href="#ç±»ç»“æ„è®¾è®¡" class="headerlink" title="ç±»ç»“æ„è®¾è®¡"></a>ç±»ç»“æ„è®¾è®¡</h2><h3 id="1-Objectç±»"><a href="#1-Objectç±»" class="headerlink" title="1. Objectç±»"></a>1. Objectç±»</h3><ul><li>æ‰€æœ‰éœ€è¦æ”¯æŒåå°„çš„ç±»çš„åŸºç±»</li><li>æä¾›åå°„æ“ä½œçš„åŸºç¡€æ¥å£</li></ul><h3 id="2-ClassFactoryç±»"><a href="#2-ClassFactoryç±»" class="headerlink" title="2. ClassFactoryç±»"></a>2. ClassFactoryç±»</h3><ul><li>åå°„ç³»ç»Ÿçš„æ ¸å¿ƒå·¥å‚ç±»</li><li>ç®¡ç†æ‰€æœ‰å·²æ³¨å†Œçš„ç±»ä¿¡æ¯</li><li>å®ç°å•ä¾‹æ¨¡å¼</li></ul><h3 id="3-ClassFieldç±»"><a href="#3-ClassFieldç±»" class="headerlink" title="3. ClassFieldç±»"></a>3. ClassFieldç±»</h3><ul><li>å°è£…ç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯</li><li>æ”¯æŒè¿è¡Œæ—¶çš„æˆå‘˜è®¿é—®</li></ul><h3 id="4-ClassMethodç±»"><a href="#4-ClassMethodç±»" class="headerlink" title="4. ClassMethodç±»"></a>4. ClassMethodç±»</h3><ul><li>å°è£…ç±»çš„æˆå‘˜å‡½æ•°ä¿¡æ¯</li><li>æ”¯æŒè¿è¡Œæ—¶çš„æ–¹æ³•è°ƒç”¨</li></ul><h3 id="5-ClassRegisterç±»"><a href="#5-ClassRegisterç±»" class="headerlink" title="5. ClassRegisterç±»"></a>5. ClassRegisterç±»</h3><ul><li>æä¾›åå°„æ³¨å†Œçš„è¾…åŠ©åŠŸèƒ½</li><li>é…åˆå®å®ç°è‡ªåŠ¨æ³¨å†Œ</li></ul><h2 id="å¸¸è§é—®é¢˜è§£ç­”-Q-amp-A"><a href="#å¸¸è§é—®é¢˜è§£ç­”-Q-amp-A" class="headerlink" title="å¸¸è§é—®é¢˜è§£ç­”(Q&amp;A)"></a>å¸¸è§é—®é¢˜è§£ç­”(Q&amp;A)</h2><h3 id="Q1-è¯·è¯¦ç»†æè¿°é¡¹ç›®ä¸­åå°„æœºåˆ¶çš„æ ¸å¿ƒå®ç°åŸç†ï¼Ÿ"><a href="#Q1-è¯·è¯¦ç»†æè¿°é¡¹ç›®ä¸­åå°„æœºåˆ¶çš„æ ¸å¿ƒå®ç°åŸç†ï¼Ÿ" class="headerlink" title="Q1: è¯·è¯¦ç»†æè¿°é¡¹ç›®ä¸­åå°„æœºåˆ¶çš„æ ¸å¿ƒå®ç°åŸç†ï¼Ÿ"></a>Q1: è¯·è¯¦ç»†æè¿°é¡¹ç›®ä¸­åå°„æœºåˆ¶çš„æ ¸å¿ƒå®ç°åŸç†ï¼Ÿ</h3><p>A1: é¡¹ç›®çš„åå°„æœºåˆ¶ä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å®ç°ï¼š</p><ol><li><p>åŸºç±»è®¾è®¡ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Object</span> &#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">get</span><span class="params">(<span class="type">const</span> string &amp; field_name, T &amp; value)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">const</span> string &amp; field_name, <span class="type">const</span> T &amp; value)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> R, <span class="keyword">typename</span> ...Args&gt;</span><br><span class="line">    <span class="function">R <span class="title">call</span><span class="params">(<span class="type">const</span> string &amp; method_name, Args&amp;&amp;... args)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string m_class_name;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>å·¥å‚æ¨¡å¼ï¼š</p></li></ol><ul><li>ä½¿ç”¨å•ä¾‹çš„ClassFactoryç®¡ç†æ‰€æœ‰åå°„ä¿¡æ¯</li><li>é€šè¿‡mapå­˜å‚¨ç±»åä¸åˆ›å»ºå‡½æ•°çš„æ˜ å°„</li><li>æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºå¯¹è±¡</li></ul><h3 id="Q2-é¡¹ç›®å¦‚ä½•å®ç°æˆå‘˜å˜é‡çš„åŠ¨æ€è®¿é—®ï¼Ÿå†…å­˜å¯¹é½æ˜¯å¦ä¼šå½±å“åå°„ï¼Ÿ"><a href="#Q2-é¡¹ç›®å¦‚ä½•å®ç°æˆå‘˜å˜é‡çš„åŠ¨æ€è®¿é—®ï¼Ÿå†…å­˜å¯¹é½æ˜¯å¦ä¼šå½±å“åå°„ï¼Ÿ" class="headerlink" title="Q2: é¡¹ç›®å¦‚ä½•å®ç°æˆå‘˜å˜é‡çš„åŠ¨æ€è®¿é—®ï¼Ÿå†…å­˜å¯¹é½æ˜¯å¦ä¼šå½±å“åå°„ï¼Ÿ"></a>Q2: é¡¹ç›®å¦‚ä½•å®ç°æˆå‘˜å˜é‡çš„åŠ¨æ€è®¿é—®ï¼Ÿå†…å­˜å¯¹é½æ˜¯å¦ä¼šå½±å“åå°„ï¼Ÿ</h3><p>A2: ä¸»è¦é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°ï¼š</p><ol><li><p>åç§»é‡è®¡ç®—ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> REGISTER_CLASS_FIELD(className, fieldName, fieldType) \</span></span><br><span class="line"><span class="meta">    className className##fieldName; \</span></span><br><span class="line"><span class="meta">    ClassRegister classRegister##className##fieldName(#className, #fieldName, #fieldType, \</span></span><br><span class="line"><span class="meta">    (size_t)(&amp;(className##fieldName.fieldName)) - (size_t)(&amp;className##fieldName))</span></span><br></pre></td></tr></table></figure></li><li><p>è®¿é—®å®ç°ï¼š</p></li></ol><ul><li>ä½¿ç”¨æŒ‡é’ˆåç§»å®ç°æˆå‘˜è®¿é—®</li><li>è€ƒè™‘äº†å†…å­˜å¯¹é½é—®é¢˜</li><li>é€šè¿‡æ¨¡æ¿å®ç°ç±»å‹å®‰å…¨</li></ul><h3 id="Q3-å¦‚ä½•å®ç°ä¸åŒç­¾åçš„æˆå‘˜å‡½æ•°çš„ç»Ÿä¸€å­˜å‚¨å’Œè°ƒç”¨ï¼Ÿ"><a href="#Q3-å¦‚ä½•å®ç°ä¸åŒç­¾åçš„æˆå‘˜å‡½æ•°çš„ç»Ÿä¸€å­˜å‚¨å’Œè°ƒç”¨ï¼Ÿ" class="headerlink" title="Q3: å¦‚ä½•å®ç°ä¸åŒç­¾åçš„æˆå‘˜å‡½æ•°çš„ç»Ÿä¸€å­˜å‚¨å’Œè°ƒç”¨ï¼Ÿ"></a>Q3: å¦‚ä½•å®ç°ä¸åŒç­¾åçš„æˆå‘˜å‡½æ•°çš„ç»Ÿä¸€å­˜å‚¨å’Œè°ƒç”¨ï¼Ÿ</h3><p>A3: é€šè¿‡ä»¥ä¸‹æŠ€æœ¯å®ç°ï¼š</p><ol><li><p>å‡½æ•°æŒ‡é’ˆç»Ÿä¸€åŒ–ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassMethod</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string m_name;</span><br><span class="line">    <span class="type">uintptr_t</span> m_method;  <span class="comment">// ç»Ÿä¸€å­˜å‚¨ä¸åŒç­¾åçš„å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>å‡½æ•°è°ƒç”¨ï¼š</p></li></ol><ul><li>ä½¿ç”¨std::functionå°è£…æˆå‘˜å‡½æ•°</li><li>é€šè¿‡æ¨¡æ¿å’Œå¯å˜å‚æ•°å®ç°é€šç”¨è°ƒç”¨</li><li>è¿è¡Œæ—¶ç±»å‹è½¬æ¢ç¡®ä¿å®‰å…¨è°ƒç”¨</li></ul><h3 id="Q4-é¡¹ç›®ä¸­å¦‚ä½•ç®€åŒ–åå°„æ³¨å†Œè¿‡ç¨‹ï¼Ÿå®å®šä¹‰çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Q4-é¡¹ç›®ä¸­å¦‚ä½•ç®€åŒ–åå°„æ³¨å†Œè¿‡ç¨‹ï¼Ÿå®å®šä¹‰çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Q4: é¡¹ç›®ä¸­å¦‚ä½•ç®€åŒ–åå°„æ³¨å†Œè¿‡ç¨‹ï¼Ÿå®å®šä¹‰çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Q4: é¡¹ç›®ä¸­å¦‚ä½•ç®€åŒ–åå°„æ³¨å†Œè¿‡ç¨‹ï¼Ÿå®å®šä¹‰çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>A4: é€šè¿‡ä»¥ä¸‹æ–¹å¼ç®€åŒ–ï¼š</p><ol><li><p>æ³¨å†Œå®ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> REGISTER_CLASS(className)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REGISTER_CLASS_FIELD(className, fieldName, fieldType)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REGISTER_CLASS_METHOD(className, methodName, returnType, ...)</span></span><br></pre></td></tr></table></figure></li><li><p>å®ç°åŸç†ï¼š</p></li></ol><ul><li>è‡ªåŠ¨ç”Ÿæˆåˆ›å»ºå‡½æ•°</li><li>è‡ªåŠ¨è®¡ç®—æˆå‘˜åç§»</li><li>è‡ªåŠ¨æ³¨å†Œåˆ°å·¥å‚ç±»</li></ul><h3 id="Q5-åå°„æœºåˆ¶å¦‚ä½•ä¿è¯ç±»å‹å®‰å…¨ï¼Ÿå¦‚ä½•å¤„ç†ç±»å‹è½¬æ¢é”™è¯¯ï¼Ÿ"><a href="#Q5-åå°„æœºåˆ¶å¦‚ä½•ä¿è¯ç±»å‹å®‰å…¨ï¼Ÿå¦‚ä½•å¤„ç†ç±»å‹è½¬æ¢é”™è¯¯ï¼Ÿ" class="headerlink" title="Q5: åå°„æœºåˆ¶å¦‚ä½•ä¿è¯ç±»å‹å®‰å…¨ï¼Ÿå¦‚ä½•å¤„ç†ç±»å‹è½¬æ¢é”™è¯¯ï¼Ÿ"></a>Q5: åå°„æœºåˆ¶å¦‚ä½•ä¿è¯ç±»å‹å®‰å…¨ï¼Ÿå¦‚ä½•å¤„ç†ç±»å‹è½¬æ¢é”™è¯¯ï¼Ÿ</h3><p>A5: ä¸»è¦é€šè¿‡ä»¥ä¸‹æœºåˆ¶ä¿è¯ï¼š</p><ol><li>ç¼–è¯‘æœŸæ£€æŸ¥ï¼š</li></ol><ul><li>ä½¿ç”¨æ¨¡æ¿å®ç°ç±»å‹æ£€æŸ¥</li><li>å­˜å‚¨ç±»å‹ä¿¡æ¯</li><li>è¿è¡Œæ—¶ç±»å‹éªŒè¯</li></ul><ol><li>è¿è¡Œæ—¶ä¿æŠ¤ï¼š<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Object::get</span><span class="params">(<span class="type">const</span> string &amp; field_name, T &amp; value)</span> </span>&#123;</span><br><span class="line">    ClassField * field = Singleton&lt;ClassFactory&gt;::<span class="built_in">instance</span>()-&gt;<span class="built_in">get_class_field</span>(m_class_name, field_name);</span><br><span class="line">    <span class="keyword">if</span> (field == <span class="literal">nullptr</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// ç±»å‹å®‰å…¨çš„æŒ‡é’ˆæ“ä½œ</span></span><br><span class="line">    value = *((T *)((<span class="type">unsigned</span> <span class="type">char</span> *)(<span class="keyword">this</span>) + field-&gt;<span class="built_in">offset</span>()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»Webæ¡†æ¶ä¸­åå°„æ¨¡å—çš„è®¾è®¡å®ç°ï¼ŒåŒ…æ‹¬æ ¸å¿ƒç±»ç»“æ„å’Œå…³é”®æŠ€æœ¯ç‚¹åˆ†æ</summary>
    
    
    
    <category term="ç³»ç»Ÿè®¾è®¡" scheme="https://eatbreads.github.io/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="C++" scheme="https://eatbreads.github.io/tags/C/"/>
    
    <category term="ç³»ç»Ÿè®¾è®¡" scheme="https://eatbreads.github.io/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="åå°„" scheme="https://eatbreads.github.io/tags/%E5%8F%8D%E5%B0%84/"/>
    
  </entry>
  
  <entry>
    <title>Webæ¡†æ¶Threadæ¨¡å—è®¾è®¡ä¸å®ç°</title>
    <link href="https://eatbreads.github.io/posts/5e8acb82.html"/>
    <id>https://eatbreads.github.io/posts/5e8acb82.html</id>
    <published>2025-05-18T15:46:38.000Z</published>
    <updated>2025-05-21T15:48:28.176Z</updated>
    
    <content type="html"><![CDATA[<h1>Webæ¡†æ¶Threadæ¨¡å—è®¾è®¡ä¸å®ç°</h1><h2 id="æ¨¡å—æ¦‚è¿°">æ¨¡å—æ¦‚è¿°</h2><p>Threadæ¨¡å—æ˜¯æ•´ä¸ªæ¡†æ¶çš„å¹¶å‘å¤„ç†æ ¸å¿ƒï¼Œé‡‡ç”¨é¢å‘å¯¹è±¡çš„è®¾è®¡å®ç°äº†çº¿ç¨‹æ± å’Œä»»åŠ¡è°ƒåº¦åŠŸèƒ½ã€‚è¯¥æ¨¡å—ä½äº <code>thread</code> ç›®å½•ä¸‹ã€‚</p><h2 id="ç±»ç»“æ„è®¾è®¡">ç±»ç»“æ„è®¾è®¡</h2><h3 id="1-ThreadåŸºç±»">1. ThreadåŸºç±»</h3><ul><li>æä¾›äº†startã€stopå’Œä¸€ä¸ªrunçº¯è™šå‡½æ•°ä¾›å­ç±» å®ç°</li></ul><h3 id="2-WorkerThreadç±»">2. WorkerThreadç±»</h3><ul><li>å…·ä½“çš„å·¥ä½œçº¿ç¨‹ç±»</li><li>runå‡½æ•°å†…éƒ¨ä¼šæ‰§è¡Œtaskä»»åŠ¡</li><li>assignå‡½æ•°å¯ä»¥ç»™ä»–èµ‹å€¼å½“å‰taskï¼Œç„¶åå”¤é†’runå‡½æ•°ç»§ç»­å¤„ç†æ–°ä»»åŠ¡</li></ul><h3 id="3-ThreadPoolç±»">3. ThreadPoolç±»</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadPool</span> &#123;</span><br><span class="line">    std::list&lt;WorkerThread*&gt; m_pool;    <span class="comment">// è£…è½½äº†çº¿ç¨‹</span></span><br><span class="line">    <span class="comment">// æä¾›assign(Task* task)æ–¹æ³•ä¸¢å…¥å·¥ä½œçº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="4-TaskDispatcherç±»">4. TaskDispatcherç±»</h3><ul><li>ç›¸å½“äºåˆåŒ…è£…äº†ä¸€å±‚threadPool</li><li>ä½¿å¾—èµ‹å€¼taskä¸éœ€è¦ç›´æ¥æ“ä½œthreadpool</li></ul><h2 id="å¸¸è§é—®é¢˜è§£ç­”-Q-A">å¸¸è§é—®é¢˜è§£ç­”(Q&amp;A)</h2><h3 id="Q1-è¯·è¯¦ç»†æè¿°é¡¹ç›®ä¸­çº¿ç¨‹æ± çš„å®ç°åŸç†ï¼Œä»¥åŠå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ">Q1: è¯·è¯¦ç»†æè¿°é¡¹ç›®ä¸­çº¿ç¨‹æ± çš„å®ç°åŸç†ï¼Œä»¥åŠå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h3><p>A1: çº¿ç¨‹æ± å®ç°ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li>æ ¸å¿ƒç»„ä»¶ï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadPool</span> &#123;</span><br><span class="line">    std::list&lt;WorkerThread*&gt; m_pool;    <span class="comment">// çº¿ç¨‹æ± å®¹å™¨</span></span><br><span class="line">    Mutex m_mutex;                      <span class="comment">// äº’æ–¥é”</span></span><br><span class="line">    Condition m_cond;                   <span class="comment">// æ¡ä»¶å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>çº¿ç¨‹å®‰å…¨ä¿è¯ï¼š</li></ol><ul><li>ä½¿ç”¨RAIIæ–¹å¼çš„ <code>auto_lock.cpp</code> ç¡®ä¿é”çš„è‡ªåŠ¨é‡Šæ”¾</li><li>æ¡ä»¶å˜é‡å®ç°çº¿ç¨‹åŒæ­¥</li><li>ä»»åŠ¡é˜Ÿåˆ—çš„åŸå­æ“ä½œ</li></ul><h3 id="Q2-é¡¹ç›®ä¸­TaskDispatcheræ˜¯å¦‚ä½•å®ç°ä»»åŠ¡åˆ†å‘çš„ï¼Ÿå¦‚ä½•å¤„ç†ä»»åŠ¡é˜Ÿåˆ—æ»¡çš„æƒ…å†µï¼Ÿ">Q2: é¡¹ç›®ä¸­TaskDispatcheræ˜¯å¦‚ä½•å®ç°ä»»åŠ¡åˆ†å‘çš„ï¼Ÿå¦‚ä½•å¤„ç†ä»»åŠ¡é˜Ÿåˆ—æ»¡çš„æƒ…å†µï¼Ÿ</h3><p>A2: ä»»åŠ¡è°ƒåº¦ä¸»è¦é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°ï¼š</p><ol><li>ä»»åŠ¡åˆ†å‘æµç¨‹ï¼š</li></ol><ul><li>å…ˆå°è¯•ç›´æ¥åˆ†é…ç»™ç©ºé—²çº¿ç¨‹</li><li>å¦‚æœæ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œå°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—å‰ç«¯</li><li>ä½¿ç”¨æ¡ä»¶å˜é‡é€šçŸ¥å·¥ä½œçº¿ç¨‹</li></ul><ol start="2"><li>å¤„ç†ç­–ç•¥ï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TaskDispatcher::handle</span><span class="params">(Task * task)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!pool-&gt;<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        pool-&gt;<span class="built_in">assign</span>(task);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰€æœ‰çº¿ç¨‹å¿™ç¢Œæ—¶ï¼Œå°†ä»»åŠ¡æ”¾å›é˜Ÿåˆ—å‰ç«¯</span></span><br><span class="line">        m_queue.<span class="built_in">push_front</span>(task);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Q3-é¡¹ç›®ä¸­å¦‚ä½•é¢„é˜²æ­»é”ï¼Ÿå¦‚ä½•å¤„ç†çº¿ç¨‹å¼‚å¸¸ï¼Ÿ">Q3: é¡¹ç›®ä¸­å¦‚ä½•é¢„é˜²æ­»é”ï¼Ÿå¦‚ä½•å¤„ç†çº¿ç¨‹å¼‚å¸¸ï¼Ÿ</h3><p>A3: ä¸»è¦é€šè¿‡ä»¥ä¸‹æœºåˆ¶ï¼š</p><ol><li>æ­»é”é¢„é˜²ï¼š</li></ol><ul><li>ä½¿ç”¨RAIIæŠ€æœ¯ç®¡ç†é”èµ„æº</li><li>ç»Ÿä¸€çš„åŠ é”é¡ºåº</li><li>ä½¿ç”¨æ¡ä»¶å˜é‡é¿å…å¿™ç­‰å¾…</li></ul><ol start="2"><li>å¼‚å¸¸å¤„ç†ï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">WorkerThread::run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">pthread_cleanup_push</span>(cleanup, <span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// ... ä¸šåŠ¡é€»è¾‘ ...</span></span><br><span class="line">    <span class="built_in">pthread_cleanup_pop</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Q4-ä¸ºä»€ä¹ˆè¦åœ¨å·¥ä½œçº¿ç¨‹ä¸­å±è”½ä¿¡å·ï¼Ÿå¦‚ä½•å®ç°çš„ï¼Ÿ">Q4: ä¸ºä»€ä¹ˆè¦åœ¨å·¥ä½œçº¿ç¨‹ä¸­å±è”½ä¿¡å·ï¼Ÿå¦‚ä½•å®ç°çš„ï¼Ÿ</h3><p>A4: ä¿¡å·å¤„ç†çš„è€ƒè™‘ï¼š</p><ol><li>å±è”½åŸå› ï¼š</li></ol><ul><li>é¿å…ä¿¡å·å¤„ç†ç¨‹åºå¹²æ‰°æ­£å¸¸ä¸šåŠ¡é€»è¾‘</li><li>ç»Ÿä¸€åœ¨ä¸»çº¿ç¨‹å¤„ç†ä¿¡å·</li></ul><ol start="2"><li>å®ç°æ–¹å¼ï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">sigset_t</span> mask;</span><br><span class="line"><span class="built_in">sigfillset</span>(&amp;mask);</span><br><span class="line"><span class="built_in">pthread_sigmask</span>(SIG_SETMASK, &amp;mask, <span class="literal">nullptr</span>);</span><br></pre></td></tr></table></figure><h3 id="Q5-å¦‚ä½•å¤„ç†çº¿ç¨‹æ± æ»¡è½½æƒ…å†µï¼Ÿæ˜¯å¦æ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Ÿ">Q5: å¦‚ä½•å¤„ç†çº¿ç¨‹æ± æ»¡è½½æƒ…å†µï¼Ÿæ˜¯å¦æ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Ÿ</h3><p>A5: å¤„ç†ç­–ç•¥ï¼š</p><ol><li>å½“å‰å®ç°ï¼š</li></ol><ul><li>ä½¿ç”¨ä»»åŠ¡é˜Ÿåˆ—ç¼“å­˜ä»»åŠ¡</li><li>è®°å½•è­¦å‘Šæ—¥å¿—</li><li>ç­‰å¾…ç©ºé—²çº¿ç¨‹</li></ul><ol start="2"><li>ä¼˜åŒ–å»ºè®®ï¼š</li></ol><ul><li>å¯ä»¥æ·»åŠ åŠ¨æ€æ‰©å®¹æœºåˆ¶</li><li>å®ç°ä»»åŠ¡ä¼˜å…ˆçº§</li><li>æ·»åŠ ä»»åŠ¡è¶…æ—¶æœºåˆ¶</li></ul><h3 id="Q6-é¡¹ç›®ä¸­å¦‚ä½•ç¡®ä¿çº¿ç¨‹èµ„æºçš„æ­£ç¡®é‡Šæ”¾ï¼Ÿ">Q6: é¡¹ç›®ä¸­å¦‚ä½•ç¡®ä¿çº¿ç¨‹èµ„æºçš„æ­£ç¡®é‡Šæ”¾ï¼Ÿ</h3><p>A6: é€šè¿‡ä»¥ä¸‹æœºåˆ¶ä¿è¯ï¼š</p><ol><li>çº¿ç¨‹èµ„æºï¼š</li></ol><ul><li>ä½¿ç”¨RAIIç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</li><li>æ¸…ç†å‡½æ•°ç¡®ä¿èµ„æºé‡Šæ”¾</li><li>çº¿ç¨‹æ± ç»Ÿä¸€ç®¡ç†</li></ul>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»Webæ¡†æ¶ä¸­Threadæ¨¡å—çš„è®¾è®¡å®ç°ï¼ŒåŒ…æ‹¬çº¿ç¨‹æ± ã€ä»»åŠ¡è°ƒåº¦ç­‰æ ¸å¿ƒåŠŸèƒ½</summary>
    
    
    
    <category term="ç³»ç»Ÿè®¾è®¡" scheme="https://eatbreads.github.io/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="å¤šçº¿ç¨‹" scheme="https://eatbreads.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
    <category term="C++" scheme="https://eatbreads.github.io/tags/C/"/>
    
    <category term="ç³»ç»Ÿè®¾è®¡" scheme="https://eatbreads.github.io/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>webæ¨¡å—ä»‹ç»-ç½‘ç»œsocketç¯‡-å«QA</title>
    <link href="https://eatbreads.github.io/posts/8fc563d2.html"/>
    <id>https://eatbreads.github.io/posts/8fc563d2.html</id>
    <published>2025-05-17T15:31:22.000Z</published>
    <updated>2025-05-17T15:36:03.353Z</updated>
    
    <content type="html"><![CDATA[<h1>Webæ¡†æ¶Socketæ¨¡å—è®¾è®¡ä¸å®ç°</h1><h2 id="æ¨¡å—æ¦‚è¿°">æ¨¡å—æ¦‚è¿°</h2><p>Socketæ¨¡å—æ˜¯æ•´ä¸ªWebæ¡†æ¶çš„ç½‘ç»œé€šä¿¡åŸºç¡€ï¼Œé‡‡ç”¨é¢å‘å¯¹è±¡çš„è®¾è®¡æ–¹å¼ï¼Œå®ç°äº†TCPç½‘ç»œé€šä¿¡çš„å®Œæ•´åŠŸèƒ½ã€‚</p><h2 id="ç±»ç»“æ„è®¾è®¡">ç±»ç»“æ„è®¾è®¡</h2><h3 id="1-åŸºç¡€Socketç±»-socket-h">1. åŸºç¡€Socketç±» (socket.h)</h3><ul><li>æä¾›ç»Ÿä¸€çš„æ¥å£ï¼šbindã€listenã€connectã€acceptç­‰</li><li>å®ç°äº†å¤šä¸ªsocketä¼˜åŒ–é…ç½®é€‰é¡¹</li></ul><h3 id="2-æœåŠ¡ç«¯Socketå’Œå®¢æˆ·ç«¯Socket">2. æœåŠ¡ç«¯Socketå’Œå®¢æˆ·ç«¯Socket</h3><ul><li>ç»§æ‰¿äºsocketåŸºç±»</li><li>å¯¹ä¸šåŠ¡è¿›è¡Œé’ˆå¯¹æ€§ç®€åŒ–</li></ul><h3 id="3-Socketå¤„ç†å™¨-socket-handler-h">3. Socketå¤„ç†å™¨ (socket_handler.h)</h3><ul><li>å†…ç½®epollå’ŒæœåŠ¡å™¨ç›‘å¬å¥æŸ„(æœåŠ¡å™¨å”¯ä¸€å®ä¾‹)</li><li>å†…éƒ¨æä¾›handleræ¥å£å¯¹æ–°è¿æ¥æ‰§è¡Œå¤„ç†(è·å–å·¥å‚å®ä¾‹,assignä»»åŠ¡)</li></ul><h2 id="å¸¸è§é—®é¢˜è§£ç­”-Q-A">å¸¸è§é—®é¢˜è§£ç­”(Q&amp;A)</h2><h3 id="Q1-é¡¹ç›®ä¸­ä½¿ç”¨äº†epollè¿›è¡ŒIOå¤šè·¯å¤ç”¨ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©epollè€Œä¸æ˜¯select-pollï¼Ÿepollçš„EPOLLONESHOTæ ‡å¿—ä½çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ">Q1: é¡¹ç›®ä¸­ä½¿ç”¨äº†epollè¿›è¡ŒIOå¤šè·¯å¤ç”¨ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©epollè€Œä¸æ˜¯select/pollï¼Ÿepollçš„EPOLLONESHOTæ ‡å¿—ä½çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>A1: è¿™ä¸ªé—®é¢˜å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å›ç­”ï¼š</p><ol><li><p>epollç›¸æ¯”select/pollçš„ä¼˜åŠ¿ï¼š</p><ul><li>select/pollæ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦å°†fdé›†åˆä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œè€Œepollé€šè¿‡mmapå®ç°å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´çš„å…±äº«å†…å­˜</li><li>select/polléƒ½éœ€è¦éå†æ•´ä¸ªfdé›†åˆï¼Œè€Œepollé‡‡ç”¨å›è°ƒæœºåˆ¶ï¼Œåªå…³æ³¨å‘ç”Ÿäº‹ä»¶çš„fd</li><li>selectæœ€å¤§æ”¯æŒ1024ä¸ªfdï¼Œpollæ²¡æœ‰é™åˆ¶ä½†æ€§èƒ½ä¼šéšfdæ•°é‡å¢é•¿è€Œä¸‹é™ï¼Œepollåˆ™åŸºæœ¬ä¸å—é™åˆ¶</li></ul></li><li><p>åœ¨ä»£ç ä¸­EPOLLONESHOTçš„ä½¿ç”¨ï¼š</p></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">SocketHandler::attach</span><span class="params">(<span class="type">int</span> sockfd)</span> </span>&#123;</span><br><span class="line">    m_epoll.<span class="built_in">add</span>(sockfd, (EPOLLIN | EPOLLHUP | EPOLLERR | EPOLLONESHOT));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EPOLLONESHOTç¡®ä¿ä¸€ä¸ªsocketè¿æ¥åœ¨ä»»æ„æ—¶åˆ»åªè¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œé˜²æ­¢å¤šçº¿ç¨‹ä¸‹çš„å¹¶å‘é—®é¢˜ã€‚</p><h3 id="Q2-é¡¹ç›®ä¸­ServerSocketçš„æ„é€ å‡½æ•°ä¸­è®¾ç½®äº†å¤šä¸ªsocketé€‰é¡¹ï¼Œè¯·è§£é‡Šè¿™äº›é€‰é¡¹çš„ä½œç”¨åŠå…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚">Q2: é¡¹ç›®ä¸­ServerSocketçš„æ„é€ å‡½æ•°ä¸­è®¾ç½®äº†å¤šä¸ªsocketé€‰é¡¹ï¼Œè¯·è§£é‡Šè¿™äº›é€‰é¡¹çš„ä½œç”¨åŠå…¶å¯¹æ€§èƒ½çš„å½±å“ã€‚</h3><p>A2: å‚è€ƒ <code>server_socket.cpp</code> ä¸­çš„å®ç°ï¼š</p><ol><li>set_recv_buffer/set_send_buffer : è®¾ç½®10KBçš„æ”¶å‘ç¼“å†²åŒºï¼Œç”¨äºè°ƒèŠ‚æ•°æ®ä¼ è¾“çš„ç¼“å†²å¤§å°</li><li>set_linger : æ§åˆ¶socketå…³é—­æ—¶çš„è¡Œä¸ºï¼Œè®¾ç½®ä¸ºtrueä¸”timeoutä¸º0è¡¨ç¤ºç«‹å³å…³é—­</li><li>set_keepalive : ä¿æŒè¿æ¥æ´»è·ƒï¼Œå®šæœŸæ£€æµ‹è¿æ¥çŠ¶æ€</li><li>set_reuseaddr : å…è®¸åœ°å€é‡ç”¨ï¼ŒæœåŠ¡å™¨é‡å¯æ—¶å¯ä»¥ç«‹å³ç»‘å®šç«¯å£</li></ol><h3 id="Q3-é¡¹ç›®ä¸­å¦‚ä½•å¤„ç†socketçš„å¼‚å¸¸æƒ…å†µï¼Ÿæ¯”å¦‚å®¢æˆ·ç«¯å¼‚å¸¸æ–­å¼€ã€è¿æ¥è¶…æ—¶ç­‰ã€‚">Q3: é¡¹ç›®ä¸­å¦‚ä½•å¤„ç†socketçš„å¼‚å¸¸æƒ…å†µï¼Ÿæ¯”å¦‚å®¢æˆ·ç«¯å¼‚å¸¸æ–­å¼€ã€è¿æ¥è¶…æ—¶ç­‰ã€‚</h3><p>A3: ä¸»è¦é€šè¿‡ä»¥ä¸‹æœºåˆ¶å¤„ç†ï¼š</p><ol><li>epolläº‹ä»¶ç›‘æ§ï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (m_epoll.<span class="built_in">is_set</span>(i, EPOLLHUP)) &#123;</span><br><span class="line">    <span class="built_in">log_error</span>(<span class="string">&quot;socket hang up by peer: conn=%d&quot;</span>, connfd);</span><br><span class="line">    Singleton&lt;TaskFactory&gt;::<span class="built_in">instance</span>()-&gt;<span class="built_in">remove</span>(connfd);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (m_epoll.<span class="built_in">is_set</span>(i, EPOLLERR)) &#123;</span><br><span class="line">    <span class="built_in">log_error</span>(<span class="string">&quot;socket error: conn=%d&quot;</span>, connfd);</span><br><span class="line">    Singleton&lt;TaskFactory&gt;::<span class="built_in">instance</span>()-&gt;<span class="built_in">remove</span>(connfd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>èµ„æºæ¸…ç†ï¼š</li></ol><ul><li>ä½¿ç”¨TaskFactoryç®¡ç†è¿æ¥å¯¹åº”çš„ä»»åŠ¡</li><li>åŠæ—¶æ¸…ç†æ–­å¼€çš„è¿æ¥</li><li>å®Œå–„çš„é”™è¯¯æ—¥å¿—è®°å½•</li></ul><h3 id="Q4-é¡¹ç›®ä¸­Socketæ¨¡å—ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿™äº›æ¨¡å¼ï¼Ÿ">Q4: é¡¹ç›®ä¸­Socketæ¨¡å—ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿™äº›æ¨¡å¼ï¼Ÿ</h3><p>A4: ä¸»è¦ä½¿ç”¨äº†ä»¥ä¸‹è®¾è®¡æ¨¡å¼ï¼š</p><ol><li>å•ä¾‹æ¨¡å¼ï¼šSocketHandleré‡‡ç”¨å•ä¾‹æ¨¡å¼ï¼Œç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªsocketç®¡ç†å™¨</li><li>å·¥å‚æ¨¡å¼ï¼šTaskFactoryè´Ÿè´£åˆ›å»ºå’Œç®¡ç†ä»»åŠ¡</li><li>ç­–ç•¥æ¨¡å¼ï¼šé€šè¿‡ç»§æ‰¿SocketåŸºç±»å®ç°ServerSocketå’ŒClientSocketï¼Œæä¾›ä¸åŒçš„è¿æ¥ç­–ç•¥</li></ol><h3 id="Q5-é¡¹ç›®å¦‚ä½•ä¿è¯é•¿è¿æ¥çš„ç¨³å®šæ€§ï¼Ÿå¦‚ä½•å¤„ç†å¿ƒè·³æ£€æµ‹ï¼Ÿ">Q5: é¡¹ç›®å¦‚ä½•ä¿è¯é•¿è¿æ¥çš„ç¨³å®šæ€§ï¼Ÿå¦‚ä½•å¤„ç†å¿ƒè·³æ£€æµ‹ï¼Ÿ</h3><p>A5: ä¸»è¦é€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°ï¼š</p><ol><li>keepaliveæœºåˆ¶ï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Socket::set_keepalive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">setsockopt</span>(m_sockfd, SOL_SOCKET, SO_KEEPALIVE, &amp;flag, <span class="built_in">sizeof</span>(flag)) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">log_error</span>(<span class="string">&quot;socket set_keep_alive error: errno=%d errmsg=%s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>è¶…æ—¶æ£€æµ‹ï¼š</li></ol><ul><li>é€šè¿‡epollçš„timeoutå‚æ•°å®ç°è¶…æ—¶æ£€æµ‹</li><li>é…åˆTaskFactoryç®¡ç†è¿æ¥çŠ¶æ€</li><li>å¼‚å¸¸æƒ…å†µåŠæ—¶æ¸…ç†èµ„æº</li></ul>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»Webæ¡†æ¶ä¸­Socketæ¨¡å—çš„è®¾è®¡å®ç°ï¼ŒåŒ…æ‹¬ç±»ç»“æ„ã€æ ¸å¿ƒåŠŸèƒ½å’Œå¸¸è§é—®é¢˜è§£ç­”</summary>
    
    
    
    <category term="ç³»ç»Ÿè®¾è®¡" scheme="https://eatbreads.github.io/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    
    <category term="C++" scheme="https://eatbreads.github.io/tags/C/"/>
    
    <category term="ç½‘ç»œç¼–ç¨‹" scheme="https://eatbreads.github.io/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    
    <category term="Socket" scheme="https://eatbreads.github.io/tags/Socket/"/>
    
  </entry>
  
  <entry>
    <title>LeetCodeåŒæŒ‡é’ˆç»å…¸é¢˜ç›®è§£æ</title>
    <link href="https://eatbreads.github.io/posts/aec0840e.html"/>
    <id>https://eatbreads.github.io/posts/aec0840e.html</id>
    <published>2025-05-16T15:38:24.000Z</published>
    <updated>2025-05-17T02:36:46.724Z</updated>
    
    <content type="html"><![CDATA[<h1>LeetCodeåŒæŒ‡é’ˆç»å…¸é¢˜ç›®è§£æ</h1><h2 id="283-ç§»åŠ¨é›¶">283. ç§»åŠ¨é›¶</h2><h3 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h3><ul><li>ä½¿ç”¨åŒæŒ‡é’ˆæŠ€å·§</li><li>å·¦æŒ‡é’ˆæ ‡è®°å½“å‰éœ€è¦å¡«å……éé›¶æ•°çš„ä½ç½®</li><li>å³æŒ‡é’ˆéå†æ•°ç»„å¯»æ‰¾éé›¶æ•°</li><li>é‡åˆ°éé›¶æ•°å°±äº¤æ¢ä¸¤ä¸ªæŒ‡é’ˆä½ç½®çš„å€¼</li></ul><h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">moveZeroes</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> start = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> size = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; size ; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">swap</span>(nums[start++],nums[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="11-ç››æœ€å¤šæ°´çš„å®¹å™¨">11. ç››æœ€å¤šæ°´çš„å®¹å™¨</h2><h3 id="è§£é¢˜æ€è·¯-2">è§£é¢˜æ€è·¯</h3><ul><li>ä½¿ç”¨å·¦å³åŒæŒ‡é’ˆå‘ä¸­é—´æ”¶ç¼©</li><li>æ¯æ¬¡ç§»åŠ¨è¾ƒçŸ­çš„é‚£ä¸ªè¾¹</li><li>è®¡ç®—è¿‡ç¨‹ä¸­ç»´æŠ¤æœ€å¤§é¢ç§¯</li><li>é¢ç§¯è®¡ç®—ï¼šå®½åº¦ï¼ˆå³æŒ‡é’ˆ-å·¦æŒ‡é’ˆï¼‰* é«˜åº¦ï¼ˆä¸¤æŒ‡é’ˆé«˜åº¦çš„è¾ƒå°å€¼ï¼‰</li></ul><h3 id="ä»£ç å®ç°-2">ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxArea</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; height)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> left = <span class="number">0</span>; </span><br><span class="line">        <span class="type">int</span> right = height.<span class="built_in">size</span>()<span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> maxA = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt; right)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> minheight = <span class="built_in">min</span>(height[left],height[right]);</span><br><span class="line">            <span class="type">int</span> vol = minheight * (right - left);</span><br><span class="line"></span><br><span class="line">            maxA = <span class="built_in">max</span>(maxA,vol);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(height[right]&lt;height[left])</span><br><span class="line">            &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> left++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="15-ä¸‰æ•°ä¹‹å’Œ">15. ä¸‰æ•°ä¹‹å’Œ</h2><h3 id="è§£é¢˜æ€è·¯-3">è§£é¢˜æ€è·¯</h3><ul><li>å…ˆå°†æ•°ç»„æ’åº</li><li>å›ºå®šç¬¬ä¸€ä¸ªæ•°ï¼Œç„¶åç”¨åŒæŒ‡é’ˆå¯»æ‰¾å¦å¤–ä¸¤ä¸ªæ•°</li><li>æ³¨æ„å»é‡å¤„ç†ï¼š<ol><li>å›ºå®šæ•°å­—æ—¶è·³è¿‡é‡å¤å€¼</li><li>å·¦å³æŒ‡é’ˆç§»åŠ¨æ—¶ä¹Ÿè¦è·³è¿‡é‡å¤å€¼</li></ol></li><li>ä¼˜åŒ–ï¼š<ol><li>å½“å›ºå®šæ•°å­—å¤§äº0æ—¶å¯ä»¥ç›´æ¥break</li><li>å½“å’Œå¤§äº0æ—¶å³æŒ‡é’ˆå·¦ç§»ï¼Œå°äº0æ—¶å·¦æŒ‡é’ˆå³ç§»</li></ol></li></ul><h3 id="ä»£ç å®ç°-3">ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">threeSum</span>(vector&lt;<span class="type">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(),nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> size = nums.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; ret;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt; size; i++)</span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="keyword">if</span>(i!=<span class="number">0</span>&amp;&amp;nums[i]==nums[i<span class="number">-1</span>]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> target = <span class="number">0</span> - nums[i];</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> left = i<span class="number">+1</span>;</span><br><span class="line">            <span class="type">int</span> right = size <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(left &lt; right)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[left]+nums[right]&lt;target)</span><br><span class="line">                &#123;</span><br><span class="line">                    left++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(nums[left]+nums[right]&gt;target)</span><br><span class="line">                &#123;</span><br><span class="line">                    right--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> </span><br><span class="line">                &#123;</span><br><span class="line">                    ret.<span class="built_in">push_back</span>(&#123;nums[i],nums[left],nums[right]&#125;);</span><br><span class="line">                    <span class="type">int</span> pre = nums[left];</span><br><span class="line">                    <span class="keyword">while</span>(left&lt;right &amp;&amp; pre == nums[left])left++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="42-æ¥é›¨æ°´">42. æ¥é›¨æ°´</h2><h3 id="è§£é¢˜æ€è·¯-4">è§£é¢˜æ€è·¯</h3><ul><li>åŒæŒ‡é’ˆæ³•ï¼š<ol><li>ä½¿ç”¨å·¦å³æŒ‡é’ˆä»ä¸¤ç«¯å‘ä¸­é—´ç§»åŠ¨</li><li>ç»´æŠ¤å·¦å³ä¸¤è¾¹çš„æœ€å¤§é«˜åº¦</li><li>è¾ƒä½çš„ä¸€è¾¹å¯ä»¥ç¡®å®šå½“å‰ä½ç½®èƒ½æ¥çš„é›¨æ°´</li><li>ç§»åŠ¨è¾ƒä½çš„ä¸€è¾¹çš„æŒ‡é’ˆ</li></ol></li></ul><h3 id="ä»£ç å®ç°-4">ä»£ç å®ç°</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">trap</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; h)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è®°å½•æ¯ä¸€æ ¹æŸ±å­å·¦å³çš„æœ€å¤§å€¼ä¸­çš„æœ€å°å€¼,è‹¥æ²¡æœ‰åŒæ—¶æœ‰æ¯”ä»–è‡ªèº«å¤§çš„æœ€å¤§å€¼åˆ™è®¾ç½®ä¸º0</span></span><br><span class="line">        <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> m=<span class="number">0</span>;<span class="comment">//é™¤æŸ±å­æœ¬èº«å‰ç¼€æœ€å¤§å€¼</span></span><br><span class="line">        <span class="type">int</span> n=h.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;<span class="built_in">a</span>(n,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(m&gt;h[i])</span><br><span class="line">            a[i]=m;</span><br><span class="line">            <span class="keyword">else</span> a[i]=<span class="number">0</span>;</span><br><span class="line">            m=<span class="built_in">max</span>(m,h[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        m=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=n<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(m&gt;h[i])</span><br><span class="line">            a[i]=<span class="built_in">min</span>(m,a[i]);</span><br><span class="line">            <span class="keyword">else</span> a[i]=<span class="number">0</span>;</span><br><span class="line">            m=<span class="built_in">max</span>(m,h[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i])</span><br><span class="line">            ret+=a[i]-h[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è¯¦ç»†åˆ†æLeetCodeä¸­çš„ç»å…¸åŒæŒ‡é’ˆé¢˜ç›®ï¼ŒåŒ…æ‹¬ç§»åŠ¨é›¶ã€ç››æ°´å®¹å™¨ã€ä¸‰æ•°ä¹‹å’Œç­‰é¢˜ç›®</summary>
    
    
    
    <category term="ç®—æ³•é¢˜è§£" scheme="https://eatbreads.github.io/categories/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
    
    <category term="LeetCode" scheme="https://eatbreads.github.io/tags/LeetCode/"/>
    
    <category term="ç®—æ³•" scheme="https://eatbreads.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="åŒæŒ‡é’ˆ" scheme="https://eatbreads.github.io/tags/%E5%8F%8C%E6%8C%87%E9%92%88/"/>
    
  </entry>
  
  <entry>
    <title>LeetCodeå“ˆå¸Œè¡¨ç»å…¸é¢˜ç›®è§£æ</title>
    <link href="https://eatbreads.github.io/posts/b7b164ae.html"/>
    <id>https://eatbreads.github.io/posts/b7b164ae.html</id>
    <published>2025-05-15T15:38:24.000Z</published>
    <updated>2025-05-15T15:41:46.633Z</updated>
    
    <content type="html"><![CDATA[<h1>LeetCodeå“ˆå¸Œè¡¨ç»å…¸é¢˜ç›®è§£æ</h1><h2 id="1-ä¸¤æ•°ä¹‹å’Œ">1. ä¸¤æ•°ä¹‹å’Œ</h2><h3 id="è§£æ³•åˆ†æ">è§£æ³•åˆ†æ</h3><h4 id="1-æš´åŠ›æšä¸¾">1 æš´åŠ›æšä¸¾</h4><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)</li><li>æ€è·¯ï¼šå¯¹æ¯ä¸ªå…ƒç´ xï¼Œæšä¸¾å¯»æ‰¾target-x</li></ul><h4 id="2-æ’åºåŒæŒ‡é’ˆ">2 æ’åºåŒæŒ‡é’ˆ</h4><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn)</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(n)</li><li>æ€è·¯ï¼š<ol><li>ç”¨ç»“æ„ä½“ä¿å­˜å€¼å’ŒåŸå§‹ä¸‹æ ‡</li><li>æ’åºåä»é¦–å°¾å‘ä¸­é—´éå†</li><li>æ ¹æ®å’Œä¸ç›®æ ‡å€¼çš„æ¯”è¾ƒå†³å®šç§»åŠ¨æ–¹å‘</li></ol></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="built_in">A</span>()=<span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">A</span>(<span class="type">int</span> v,<span class="type">int</span> i)&#123;value=v;index=i;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">twoSum</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">        vector&lt;A&gt; vec;</span><br><span class="line">        vec.<span class="built_in">resize</span>(nums.<span class="built_in">size</span>());</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>;i&lt;nums.<span class="built_in">size</span>();i++)</span><br><span class="line">        &#123;</span><br><span class="line">            vec[i] = &#123;nums[i],i&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sort</span>(vec.<span class="built_in">begin</span>(),vec.<span class="built_in">end</span>(),[](A x,A y)&#123;</span><br><span class="line">            <span class="keyword">return</span> x.value&lt;y.value;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> left =<span class="number">0</span>, right = vec.<span class="built_in">size</span>()<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span>(left&lt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> sum = vec[left].value+vec[right].value;</span><br><span class="line">            <span class="keyword">if</span>(sum&lt;target)</span><br><span class="line">            left++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(sum&gt;target)</span><br><span class="line">            right--;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> &#123;vec[left].index,vec[right].index&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;vec[left].index,vec[right].index&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3-å“ˆå¸Œè¡¨">3 å“ˆå¸Œè¡¨</h4><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(n)</li><li>æ€è·¯ï¼š<ol><li>å“ˆå¸Œè¡¨keyå­˜å‚¨å€¼ï¼Œvalueå­˜å‚¨ä¸‹æ ‡</li><li>éå†è¿‡ç¨‹ä¸­æŸ¥æ‰¾target-x</li><li>æ²¡æ‰¾åˆ°åˆ™å°†å½“å‰å€¼åŠ å…¥å“ˆå¸Œè¡¨</li></ol></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">twoSum</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>&#123;</span><br><span class="line">    unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; hashMap; <span class="comment">// åˆ›å»ºå“ˆå¸Œè¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="type">int</span> complement = target - nums[i]; <span class="comment">// è®¡ç®—å·®å€¼</span></span><br><span class="line">        <span class="comment">// åœ¨å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾å·®å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (hashMap.<span class="built_in">find</span>(complement) != hashMap.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;hashMap[complement], i&#125;; <span class="comment">// æ‰¾åˆ°è¿”å›ä¸‹æ ‡</span></span><br><span class="line">        &#125;</span><br><span class="line">        hashMap[nums[i]] = i; <span class="comment">// å­˜å…¥å“ˆå¸Œè¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;; <span class="comment">// æ²¡æœ‰æ‰¾åˆ°è¿”å›ç©ºæ•°ç»„</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="49-å­—æ¯å¼‚ä½è¯åˆ†ç»„">49. å­—æ¯å¼‚ä½è¯åˆ†ç»„</h2><h3 id="è§£æ³•åˆ†æ-2">è§£æ³•åˆ†æ</h3><h4 id="å“ˆå¸Œè¡¨æ³•">å“ˆå¸Œè¡¨æ³•</h4><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(nklogk)ï¼Œkæ˜¯å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(nk)</li><li>æ€è·¯ï¼š<ol><li>keyä¸ºæ’åºåçš„å­—ç¬¦ä¸²</li><li>valueä¸ºåŸå§‹å­—ç¬¦ä¸²æ•°ç»„</li><li>æœ€åéå†å“ˆå¸Œè¡¨æ•´ç†ç»“æœ</li></ol></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;string&gt;&gt; <span class="built_in">groupAnagrams</span>(vector&lt;string&gt;&amp; strs) &#123;</span><br><span class="line">        map&lt;string,vector&lt;string&gt;&gt; mp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp; str: strs)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">auto</span> s = str;</span><br><span class="line">            <span class="built_in">sort</span>(str.<span class="built_in">begin</span>(),str.<span class="built_in">end</span>());</span><br><span class="line">            mp[str].<span class="built_in">emplace_back</span>(s);</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;vector&lt;string&gt;&gt; ret;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp; kv: mp)</span><br><span class="line">        &#123;</span><br><span class="line">            ret.<span class="built_in">emplace_back</span>(kv.second);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="128-æœ€é•¿è¿ç»­åºåˆ—">128. æœ€é•¿è¿ç»­åºåˆ—</h2><h3 id="è§£æ³•åˆ†æ-3">è§£æ³•åˆ†æ</h3><h4 id="å“ˆå¸Œé›†åˆ">å“ˆå¸Œé›†åˆ</h4><ul><li>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</li><li>ç©ºé—´å¤æ‚åº¦ï¼šO(n)</li><li>æ€è·¯ï¼š<ol><li>å°†æ‰€æœ‰æ•°å­—åŠ å…¥é›†åˆ</li><li>éå†æ¯ä¸ªæ•°xï¼Œå¯»æ‰¾x+1, x+2â€¦å’Œx-1, x-2â€¦</li><li>è¾¹éå†è¾¹ä»é›†åˆä¸­åˆ é™¤</li><li>ç»´æŠ¤æœ€å¤§é•¿åº¦</li></ol></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">longestConsecutive</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        unordered_set&lt;<span class="type">int</span>&gt; st;</span><br><span class="line">        <span class="type">int</span> count = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i&lt;count;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            st.<span class="built_in">insert</span>(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> maxlen = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!st.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> num = *(st.<span class="built_in">begin</span>());</span><br><span class="line">            st.<span class="built_in">erase</span>(num);</span><br><span class="line">            </span><br><span class="line">            <span class="type">int</span> cnt = <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> a=<span class="number">1</span>,b=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(st.<span class="built_in">find</span>(num+a)!=st.<span class="built_in">end</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                st.<span class="built_in">erase</span>(num+a);</span><br><span class="line">                cnt++;    a++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(st.<span class="built_in">find</span>(num-b)!=st.<span class="built_in">end</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                st.<span class="built_in">erase</span>(num-b);</span><br><span class="line">                cnt++;    b++;</span><br><span class="line">            &#125;</span><br><span class="line">            maxlen = <span class="built_in">max</span>(cnt,maxlen);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxlen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è¯¦ç»†åˆ†æLeetCodeä¸­çš„ç»å…¸å“ˆå¸Œè¡¨é¢˜ç›®ï¼ŒåŒ…æ‹¬ä¸¤æ•°ä¹‹å’Œã€å­—æ¯å¼‚ä½è¯åˆ†ç»„å’Œæœ€é•¿è¿ç»­åºåˆ—</summary>
    
    
    
    <category term="ç®—æ³•é¢˜è§£" scheme="https://eatbreads.github.io/categories/%E7%AE%97%E6%B3%95%E9%A2%98%E8%A7%A3/"/>
    
    
    <category term="LeetCode" scheme="https://eatbreads.github.io/tags/LeetCode/"/>
    
    <category term="ç®—æ³•" scheme="https://eatbreads.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="å“ˆå¸Œè¡¨" scheme="https://eatbreads.github.io/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/"/>
    
  </entry>
  
  <entry>
    <title>æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿå‡çº§ï¼šUTXOé›†åˆä¸Merkleæ ‘å®ç°</title>
    <link href="https://eatbreads.github.io/posts/9842f704.html"/>
    <id>https://eatbreads.github.io/posts/9842f704.html</id>
    <published>2025-05-13T15:48:18.000Z</published>
    <updated>2025-05-13T15:51:33.884Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿå‡çº§ï¼šUTXOé›†åˆä¸Merkleæ ‘"><a href="#æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿå‡çº§ï¼šUTXOé›†åˆä¸Merkleæ ‘" class="headerlink" title="æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿå‡çº§ï¼šUTXOé›†åˆä¸Merkleæ ‘"></a>æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿå‡çº§ï¼šUTXOé›†åˆä¸Merkleæ ‘</h1><h2 id="UTXOé›†åˆä¼˜åŒ–"><a href="#UTXOé›†åˆä¼˜åŒ–" class="headerlink" title="UTXOé›†åˆä¼˜åŒ–"></a>UTXOé›†åˆä¼˜åŒ–</h2><h3 id="1-ä¸ºä»€ä¹ˆéœ€è¦UTXOé›†åˆï¼Ÿ"><a href="#1-ä¸ºä»€ä¹ˆéœ€è¦UTXOé›†åˆï¼Ÿ" class="headerlink" title="1. ä¸ºä»€ä¹ˆéœ€è¦UTXOé›†åˆï¼Ÿ"></a>1. ä¸ºä»€ä¹ˆéœ€è¦UTXOé›†åˆï¼Ÿ</h3><p>ä¼ ç»Ÿæ–¹å¼ä¸‹ï¼ŒæŸ¥æ‰¾æœªèŠ±è´¹è¾“å‡ºéœ€è¦éå†æ•´ä¸ªåŒºå—é“¾ï¼Œè¿™ç§æ–¹å¼æ•ˆç‡ä½ä¸‹ã€‚é€šè¿‡å¼•å…¥UTXOé›†åˆï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥è¯¢å½“å‰æ‰€æœ‰æœªèŠ±è´¹è¾“å‡ºï¼Œå¤§å¤§æé«˜æ•ˆç‡ã€‚<br><img src="https://cdn-a.markji.com/files/6822f53ffae6898c0c26ffba_hd.png?e=1747153874484&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:c2Ro2_JRUcMxSSnArHqak3YBN28=" alt="å›¾ç‰‡1"></p><h3 id="2-UTXOé›†åˆå®ç°"><a href="#2-UTXOé›†åˆå®ç°" class="headerlink" title="2. UTXOé›†åˆå®ç°"></a>2. UTXOé›†åˆå®ç°</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UTXOé›†åˆç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">UTXOSet</span> &#123;</span><br><span class="line">    blockchain: Blockchain,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">UTXOSet</span> &#123;</span><br><span class="line">    <span class="comment">// é‡å»ºUTXOé›†åˆ</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">reindex</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="comment">// æ¸…ç©ºå½“å‰bucket</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">db</span> = <span class="keyword">self</span>.blockchain.db.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        db.<span class="title function_ invoke__">drop_bucket</span>(UTXO_BUCKET)?;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰UTXO</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">utxos</span> = <span class="keyword">self</span>.blockchain.<span class="title function_ invoke__">find_all_utxo</span>()?;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å­˜å‚¨åˆ°æ–°çš„bucket</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">bucket</span> = db.<span class="title function_ invoke__">create_bucket</span>(UTXO_BUCKET)?;</span><br><span class="line">        <span class="keyword">for</span> (txid, outs) <span class="keyword">in</span> utxos &#123;</span><br><span class="line">            bucket.<span class="title function_ invoke__">put</span>(txid, <span class="title function_ invoke__">serialize</span>(&amp;outs)?)?;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°UTXOé›†åˆ</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">update</span>(&amp;<span class="keyword">self</span>, block: &amp;Block) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">db</span> = <span class="keyword">self</span>.blockchain.db.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">bucket</span> = db.<span class="title function_ invoke__">get_bucket</span>(UTXO_BUCKET)?;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¤„ç†æ–°å—ä¸­çš„äº¤æ˜“</span></span><br><span class="line">        <span class="keyword">for</span> <span class="variable">tx</span> <span class="keyword">in</span> &amp;block.transactions &#123;</span><br><span class="line">            <span class="comment">// åˆ é™¤å·²èŠ±è´¹è¾“å‡º</span></span><br><span class="line">            <span class="keyword">for</span> <span class="variable">input</span> <span class="keyword">in</span> &amp;tx.vin &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">outs</span> = deserialize::&lt;TXOutputs&gt;(&amp;bucket.<span class="title function_ invoke__">get</span>(&amp;input.txid)?)?;</span><br><span class="line">                outs.outputs.<span class="title function_ invoke__">remove</span>(input.vout <span class="keyword">as</span> <span class="type">usize</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> outs.outputs.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">                    bucket.<span class="title function_ invoke__">delete</span>(&amp;input.txid)?;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    bucket.<span class="title function_ invoke__">put</span>(&amp;input.txid, <span class="title function_ invoke__">serialize</span>(&amp;outs)?)?;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ·»åŠ æ–°çš„æœªèŠ±è´¹è¾“å‡º</span></span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">new_outputs</span> = TXOutputs &#123; outputs: <span class="built_in">vec!</span>[] &#125;;</span><br><span class="line">            <span class="keyword">for</span> <span class="variable">output</span> <span class="keyword">in</span> &amp;tx.vout &#123;</span><br><span class="line">                new_outputs.outputs.<span class="title function_ invoke__">push</span>(output.<span class="title function_ invoke__">clone</span>());</span><br><span class="line">            &#125;</span><br><span class="line">            bucket.<span class="title function_ invoke__">put</span>(&amp;tx.id, <span class="title function_ invoke__">serialize</span>(&amp;new_outputs)?)?;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Merkleæ ‘å®ç°"><a href="#Merkleæ ‘å®ç°" class="headerlink" title="Merkleæ ‘å®ç°"></a>Merkleæ ‘å®ç°</h2><p><img src="https://cdn-a.markji.com/files/6822f8b22220c11a3674f080_hd.png?e=1747153874484&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:OfU55_MSwwx1dU654mki3gzdSuU=" alt="å›¾ç‰‡1"></p><h3 id="1-Merkleæ ‘çš„ä½œç”¨"><a href="#1-Merkleæ ‘çš„ä½œç”¨" class="headerlink" title="1. Merkleæ ‘çš„ä½œç”¨"></a>1. Merkleæ ‘çš„ä½œç”¨</h3><p>Merkleæ ‘å…è®¸è½»èŠ‚ç‚¹ï¼ˆSPVèŠ‚ç‚¹ï¼‰åœ¨ä¸ä¸‹è½½æ•´ä¸ªåŒºå—çš„æƒ…å†µä¸‹éªŒè¯äº¤æ˜“ï¼Œåªéœ€è¦ï¼š</p><ul><li>äº¤æ˜“å“ˆå¸Œ</li><li>Merkleæ ‘æ ¹å“ˆå¸Œ</li><li>Merkleè·¯å¾„</li></ul><h3 id="2-æ•°æ®ç»“æ„"><a href="#2-æ•°æ®ç»“æ„" class="headerlink" title="2. æ•°æ®ç»“æ„"></a>2. æ•°æ®ç»“æ„</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Merkleæ ‘èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">MerkleNode</span> &#123;</span><br><span class="line">    left: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;MerkleNode&gt;&gt;,</span><br><span class="line">    right: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;MerkleNode&gt;&gt;,</span><br><span class="line">    data: <span class="type">Vec</span>&lt;<span class="type">u8</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Merkleæ ‘</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">MerkleTree</span> &#123;</span><br><span class="line">    root: <span class="type">Option</span>&lt;MerkleNode&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-æ ¸å¿ƒå®ç°"><a href="#3-æ ¸å¿ƒå®ç°" class="headerlink" title="3. æ ¸å¿ƒå®ç°"></a>3. æ ¸å¿ƒå®ç°</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">MerkleNode</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(left: <span class="type">Option</span>&lt;MerkleNode&gt;, right: <span class="type">Option</span>&lt;MerkleNode&gt;, data: <span class="type">Vec</span>&lt;<span class="type">u8</span>&gt;) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">combined</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        combined.<span class="title function_ invoke__">extend</span>(&amp;data);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(left) = &amp;left &#123;</span><br><span class="line">            combined.<span class="title function_ invoke__">extend</span>(&amp;left.data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(right) = &amp;right &#123;</span><br><span class="line">            combined.<span class="title function_ invoke__">extend</span>(&amp;right.data);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> <span class="variable">hash</span> = crypto::<span class="title function_ invoke__">sha256</span>(&amp;combined);</span><br><span class="line">        </span><br><span class="line">        MerkleNode &#123;</span><br><span class="line">            left: left.<span class="title function_ invoke__">map</span>(<span class="type">Box</span>::new),</span><br><span class="line">            right: right.<span class="title function_ invoke__">map</span>(<span class="type">Box</span>::new),</span><br><span class="line">            data: hash,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">MerkleTree</span> &#123;</span><br><span class="line">    <span class="comment">// æ„å»ºMerkleæ ‘</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>(data: <span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">u8</span>&gt;&gt;) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">nodes</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ›å»ºå¶å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> <span class="variable">d</span> <span class="keyword">in</span> data &#123;</span><br><span class="line">            nodes.<span class="title function_ invoke__">push</span>(MerkleNode::<span class="title function_ invoke__">new</span>(<span class="literal">None</span>, <span class="literal">None</span>, d));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ„å»ºæ ‘</span></span><br><span class="line">        <span class="keyword">while</span> nodes.<span class="title function_ invoke__">len</span>() &gt; <span class="number">1</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">new_level</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> (<span class="number">0</span>..nodes.<span class="title function_ invoke__">len</span>()).<span class="title function_ invoke__">step_by</span>(<span class="number">2</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">left</span> = nodes[i].<span class="title function_ invoke__">clone</span>();</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">right</span> = <span class="keyword">if</span> i + <span class="number">1</span> &lt; nodes.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">                    nodes[i + <span class="number">1</span>].<span class="title function_ invoke__">clone</span>()</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nodes[i].<span class="title function_ invoke__">clone</span>()</span><br><span class="line">                &#125;;</span><br><span class="line">                </span><br><span class="line">                new_level.<span class="title function_ invoke__">push</span>(MerkleNode::<span class="title function_ invoke__">new</span>(</span><br><span class="line">                    <span class="title function_ invoke__">Some</span>(left),</span><br><span class="line">                    <span class="title function_ invoke__">Some</span>(right),</span><br><span class="line">                    <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">                ));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            nodes = new_level;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        MerkleTree &#123;</span><br><span class="line">            root: <span class="keyword">if</span> nodes.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">                <span class="literal">None</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_ invoke__">Some</span>(nodes.<span class="title function_ invoke__">remove</span>(<span class="number">0</span>))</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-åŒºå—å“ˆå¸Œè®¡ç®—ä¼˜åŒ–"><a href="#4-åŒºå—å“ˆå¸Œè®¡ç®—ä¼˜åŒ–" class="headerlink" title="4. åŒºå—å“ˆå¸Œè®¡ç®—ä¼˜åŒ–"></a>4. åŒºå—å“ˆå¸Œè®¡ç®—ä¼˜åŒ–</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Block</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">hash</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">u8</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºäº¤æ˜“çš„Merkleæ ‘</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">txs_data</span>: <span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">u8</span>&gt;&gt; = <span class="keyword">self</span>.transactions</span><br><span class="line">            .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">            .<span class="title function_ invoke__">map</span>(|tx| tx.<span class="title function_ invoke__">hash</span>())</span><br><span class="line">            .<span class="title function_ invoke__">collect</span>();</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">let</span> <span class="variable">tree</span> = MerkleTree::<span class="title function_ invoke__">new</span>(txs_data);</span><br><span class="line">        tree.root.<span class="title function_ invoke__">unwrap</span>().data</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿçš„å‡çº§å®ç°ï¼ŒåŒ…æ‹¬UTXOé›†åˆçš„ç®¡ç†å’ŒMerkleæ ‘çš„æ„å»ºè¿‡ç¨‹</summary>
    
    
    
    <category term="åŒºå—é“¾å¼€å‘" scheme="https://eatbreads.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="åŒºå—é“¾" scheme="https://eatbreads.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    <category term="Rust" scheme="https://eatbreads.github.io/tags/Rust/"/>
    
    <category term="æ¯”ç‰¹å¸" scheme="https://eatbreads.github.io/tags/%E6%AF%94%E7%89%B9%E5%B8%81/"/>
    
  </entry>
  
  <entry>
    <title>WiresharkæŠ“åŒ…å®æˆ˜åˆ†æ</title>
    <link href="https://eatbreads.github.io/posts/fe209838.html"/>
    <id>https://eatbreads.github.io/posts/fe209838.html</id>
    <published>2025-05-12T15:51:23.000Z</published>
    <updated>2025-05-13T15:51:33.881Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WiresharkæŠ“åŒ…å®æˆ˜åˆ†æ"><a href="#WiresharkæŠ“åŒ…å®æˆ˜åˆ†æ" class="headerlink" title="WiresharkæŠ“åŒ…å®æˆ˜åˆ†æ"></a>WiresharkæŠ“åŒ…å®æˆ˜åˆ†æ</h1><h2 id="ARPåè®®åˆ†æ"><a href="#ARPåè®®åˆ†æ" class="headerlink" title="ARPåè®®åˆ†æ"></a>ARPåè®®åˆ†æ</h2><p>ARPï¼ˆåœ°å€è§£æåè®®ï¼‰ç”¨äºå°†IPåœ°å€è§£æä¸ºMACåœ°å€ã€‚é€šè¿‡Wiresharkå¯ä»¥æ¸…æ™°åœ°è§‚å¯Ÿæ•´ä¸ªARPè¯·æ±‚å’Œå“åº”è¿‡ç¨‹ã€‚</p><p><img src="https://cdn-a.markji.com/files/6821acd4e67106b1a989b5ef_hd.png?e=1747062464240&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:5dem2mcOVAoMnhTUyZnHPtAPnng=" alt="å›¾ç‰‡1"></p><h3 id="ARPè¯·æ±‚-å“åº”åˆ†æ"><a href="#ARPè¯·æ±‚-å“åº”åˆ†æ" class="headerlink" title="ARPè¯·æ±‚/å“åº”åˆ†æ"></a>ARPè¯·æ±‚/å“åº”åˆ†æ</h3><ol><li>ARPè¯·æ±‚å¹¿æ’­</li><li>ç›®æ ‡ä¸»æœºå“åº”</li><li>MACåœ°å€ç¼“å­˜</li></ol><h2 id="DNSåè®®åˆ†æ"><a href="#DNSåè®®åˆ†æ" class="headerlink" title="DNSåè®®åˆ†æ"></a>DNSåè®®åˆ†æ</h2><p>DNSæŸ¥è¯¢è¿‡ç¨‹å±•ç¤ºäº†åŸŸåå¦‚ä½•è¢«è§£æä¸ºIPåœ°å€ã€‚ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå»ºè®®é…ç½®HTTPSæ¥é˜²æ­¢DNSåŠ«æŒã€‚</p><p><img src="https://cdn-a.markji.com/files/6821ad90e67106b1a989d491_hd.png?e=1747062464240&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:34DkpmluEwv7YEsfYDyd9C50keU=" alt="å›¾ç‰‡1"></p><h3 id="DNSå®‰å…¨é…ç½®"><a href="#DNSå®‰å…¨é…ç½®" class="headerlink" title="DNSå®‰å…¨é…ç½®"></a>DNSå®‰å…¨é…ç½®</h3><ol><li>ä½¿ç”¨åŠ å¯†DNS</li><li>é…ç½®HTTPS</li><li>é˜²æ­¢DNSåŠ«æŒ</li></ol><h2 id="HTTPåè®®åˆ†æ"><a href="#HTTPåè®®åˆ†æ" class="headerlink" title="HTTPåè®®åˆ†æ"></a>HTTPåè®®åˆ†æ</h2><p>é€šè¿‡Wiresharkå¯ä»¥å®Œæ•´åœ°è§‚å¯Ÿä¸€æ¬¡HTTPè¯·æ±‚çš„å…¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼š</p><p><img src="https://cdn-a.markji.com/files/6821add62d05657363d1dda0_hd.png?e=1747062464240&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:4PWw6FUKqfCWgeXEe0737YRUWh0=" alt="å›¾ç‰‡1"></p><p><img src="https://cdn-a.markji.com/files/6821c057e67106b1a98c5d42_hd.png?e=1747062464240&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:qPRSAnDi4pWgI5mHsv2qXLQOxT8=" alt="å›¾ç‰‡1"></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨Wiresharkè¿›è¡ŒARPã€DNSå’ŒHTTPåè®®çš„æŠ“åŒ…åˆ†æå®æˆ˜</summary>
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://eatbreads.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="Wireshark" scheme="https://eatbreads.github.io/tags/Wireshark/"/>
    
    <category term="ç½‘ç»œåˆ†æ" scheme="https://eatbreads.github.io/tags/%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90/"/>
    
    <category term="å®‰å…¨" scheme="https://eatbreads.github.io/tags/%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>WiresharkåŸºç¡€ä½¿ç”¨æŒ‡å—</title>
    <link href="https://eatbreads.github.io/posts/5c6d8554.html"/>
    <id>https://eatbreads.github.io/posts/5c6d8554.html</id>
    <published>2025-05-12T15:47:26.000Z</published>
    <updated>2025-05-12T15:50:12.775Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WiresharkåŸºç¡€ä½¿ç”¨æŒ‡å—"><a href="#WiresharkåŸºç¡€ä½¿ç”¨æŒ‡å—" class="headerlink" title="WiresharkåŸºç¡€ä½¿ç”¨æŒ‡å—"></a>WiresharkåŸºç¡€ä½¿ç”¨æŒ‡å—</h1><h2 id="æŠ“åŒ…è®¾ç½®"><a href="#æŠ“åŒ…è®¾ç½®" class="headerlink" title="æŠ“åŒ…è®¾ç½®"></a>æŠ“åŒ…è®¾ç½®</h2><h3 id="é€‰æ‹©ç½‘ç»œæ¥å£"><a href="#é€‰æ‹©ç½‘ç»œæ¥å£" class="headerlink" title="é€‰æ‹©ç½‘ç»œæ¥å£"></a>é€‰æ‹©ç½‘ç»œæ¥å£</h3><ol><li>æ‰“å¼€èœå•æ  <code>Capture -&gt; Option</code></li><li>é€‰æ‹©éœ€è¦ç›‘å¬çš„ç½‘ç»œæ¥å£ï¼ˆé€šå¸¸æ˜¯WLANï¼‰</li><li>ç‚¹å‡»å¼€å§‹æ•è·<br><img src="https://cdn-a.markji.com/files/682195012d05657363ced73b_hd.png?e=1747062464240&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:RLpXwtfdryDBfAHCTal-s1GxD5Y=" alt="å›¾ç‰‡1"><h2 id="æ•°æ®åŒ…åˆ†æ"><a href="#æ•°æ®åŒ…åˆ†æ" class="headerlink" title="æ•°æ®åŒ…åˆ†æ"></a>æ•°æ®åŒ…åˆ†æ</h2></li></ol><h3 id="1-åˆ†å±‚ç»“æ„"><a href="#1-åˆ†å±‚ç»“æ„" class="headerlink" title="1. åˆ†å±‚ç»“æ„"></a>1. åˆ†å±‚ç»“æ„</h3><p>Wiresharkæ˜¾ç¤ºçš„æ•°æ®åŒ…éµå¾ªOSIä¸ƒå±‚æ¨¡å‹ï¼š</p><ul><li>ç‰©ç†å±‚</li><li>æ•°æ®é“¾è·¯å±‚</li><li>ç½‘ç»œå±‚</li><li>ä¼ è¾“å±‚</li><li>ä¼šè¯å±‚</li><li>è¡¨ç¤ºå±‚</li><li>åº”ç”¨å±‚</li></ul><h3 id="2-æ•°æ®æ˜¾ç¤º"><a href="#2-æ•°æ®æ˜¾ç¤º" class="headerlink" title="2. æ•°æ®æ˜¾ç¤º"></a>2. æ•°æ®æ˜¾ç¤º</h3><p>æ¯ä¸ªæ•°æ®åŒ…éƒ½æœ‰ä¸¤ç§æ˜¾ç¤ºæ–¹å¼ï¼š</p><ul><li>åˆ†å±‚åè®®è¯¦æƒ…</li><li>16è¿›åˆ¶åŸå§‹æ•°æ®</li></ul><h2 id="è¿‡æ»¤å™¨ä½¿ç”¨"><a href="#è¿‡æ»¤å™¨ä½¿ç”¨" class="headerlink" title="è¿‡æ»¤å™¨ä½¿ç”¨"></a>è¿‡æ»¤å™¨ä½¿ç”¨</h2><p>Wiresharkæä¾›ä¸¤ç§ç±»å‹çš„è¿‡æ»¤å™¨ï¼š</p><h3 id="1-æ•è·è¿‡æ»¤å™¨"><a href="#1-æ•è·è¿‡æ»¤å™¨" class="headerlink" title="1. æ•è·è¿‡æ»¤å™¨"></a>1. æ•è·è¿‡æ»¤å™¨</h3><ul><li>åœ¨å¼€å§‹æ•è·å‰è®¾ç½®</li><li>åªæ•è·ç¬¦åˆæ¡ä»¶çš„æ•°æ®åŒ…</li><li>å‡å°‘ç³»ç»Ÿèµ„æºå ç”¨</li><li>é€‚åˆé•¿æ—¶é—´æŠ“åŒ…</li></ul><h3 id="2-æ˜¾ç¤ºè¿‡æ»¤å™¨"><a href="#2-æ˜¾ç¤ºè¿‡æ»¤å™¨" class="headerlink" title="2. æ˜¾ç¤ºè¿‡æ»¤å™¨"></a>2. æ˜¾ç¤ºè¿‡æ»¤å™¨</h3><ul><li>å¯¹å·²æ•è·çš„æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤</li><li>ä¸å½±å“æ•è·è¿‡ç¨‹</li><li>å¯ä»¥éšæ—¶ä¿®æ”¹è¿‡æ»¤æ¡ä»¶</li><li>æ›´çµæ´»çš„è¿‡æ»¤è¯­æ³•</li></ul><h2 id="å¸¸ç”¨è¿‡æ»¤è¯­æ³•"><a href="#å¸¸ç”¨è¿‡æ»¤è¯­æ³•" class="headerlink" title="å¸¸ç”¨è¿‡æ»¤è¯­æ³•"></a>å¸¸ç”¨è¿‡æ»¤è¯­æ³•</h2><h3 id="1-IPåœ°å€è¿‡æ»¤"><a href="#1-IPåœ°å€è¿‡æ»¤" class="headerlink" title="1. IPåœ°å€è¿‡æ»¤"></a>1. IPåœ°å€è¿‡æ»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ç²¾ç¡®åŒ¹é…</span><br><span class="line">ip.addr == 192.168.1.1</span><br><span class="line"></span><br><span class="line"># æ¨¡ç³ŠåŒ¹é…</span><br><span class="line">ip.addr contains 192.168</span><br></pre></td></tr></table></figure><h3 id="2-åè®®è¿‡æ»¤"><a href="#2-åè®®è¿‡æ»¤" class="headerlink" title="2. åè®®è¿‡æ»¤"></a>2. åè®®è¿‡æ»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># å•ä¸€åè®®</span><br><span class="line">http</span><br><span class="line"></span><br><span class="line"># å¤šåè®®ç»„åˆ</span><br><span class="line">http or https</span><br></pre></td></tr></table></figure><h3 id="3-ç«¯å£è¿‡æ»¤"><a href="#3-ç«¯å£è¿‡æ»¤" class="headerlink" title="3. ç«¯å£è¿‡æ»¤"></a>3. ç«¯å£è¿‡æ»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ç²¾ç¡®åŒ¹é…</span><br><span class="line">tcp.port == 80</span><br><span class="line"></span><br><span class="line"># æºç«¯å£</span><br><span class="line">tcp.srcport == 80</span><br><span class="line"></span><br><span class="line"># ç›®æ ‡ç«¯å£</span><br><span class="line">tcp.dstport == 80</span><br></pre></td></tr></table></figure><h3 id="4-ç»„åˆè¿‡æ»¤"><a href="#4-ç»„åˆè¿‡æ»¤" class="headerlink" title="4. ç»„åˆè¿‡æ»¤"></a>4. ç»„åˆè¿‡æ»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># IP + åè®® + ç«¯å£</span><br><span class="line">ip.addr == 192.168.1.1 and http and tcp.port == 80</span><br><span class="line"></span><br><span class="line"># å¤šæ¡ä»¶æ¨¡ç³ŠåŒ¹é…</span><br><span class="line">ip.addr contains 192.168 and tcp.port contains 80</span><br></pre></td></tr></table></figure><p><img src="https://cdn-a.markji.com/files/6821a908e67106b1a9894208_hd.png?e=1747062464240&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:tGkfkJXjoSGZV175f6j50AysSOs=" alt="å›¾ç‰‡1"><br><img src="https://cdn-a.markji.com/files/6821ab572d05657363d18ed8_hd.png?e=1747062464240&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:y2irddxsCry90fqf5pfHmUof9PM=" alt="å›¾ç‰‡1"></p><h2 id="è¿‡æ»¤å™¨ä½¿ç”¨æŠ€å·§"><a href="#è¿‡æ»¤å™¨ä½¿ç”¨æŠ€å·§" class="headerlink" title="è¿‡æ»¤å™¨ä½¿ç”¨æŠ€å·§"></a>è¿‡æ»¤å™¨ä½¿ç”¨æŠ€å·§</h2><ol><li><p><strong>è¿ç®—ç¬¦</strong></p><ul><li><code>==</code> ç²¾ç¡®åŒ¹é…</li><li><code>contains</code> åŒ…å«åŒ¹é…</li><li><code>and</code> ä¸</li><li><code>or</code> æˆ–</li><li><code>not</code> é</li></ul></li><li><p><strong>å¸¸ç”¨ç»„åˆ</strong></p><ul><li>ç‰¹å®šIPçš„HTTPæµé‡ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.addr == 192.168.1.1 and http</span><br></pre></td></tr></table></figure></li><li>ç‰¹å®šç«¯å£çš„TCPæµé‡ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp.port == 443 and tcp</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä¿å­˜è¿‡æ»¤å™¨</strong></p><ul><li>å¯ä»¥ä¿å­˜å¸¸ç”¨çš„è¿‡æ»¤å™¨è¡¨è¾¾å¼</li><li>æ–¹ä¾¿å¿«é€Ÿåˆ‡æ¢ä¸åŒçš„è¿‡æ»¤æ¡ä»¶</li></ul></li></ol>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»Wiresharkçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬æŠ“åŒ…è®¾ç½®ã€æ•°æ®åŒ…åˆ†æå’Œè¿‡æ»¤å™¨ä½¿ç”¨</summary>
    
    
    
    <category term="ç½‘ç»œå·¥å…·" scheme="https://eatbreads.github.io/categories/%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="Wireshark" scheme="https://eatbreads.github.io/tags/Wireshark/"/>
    
    <category term="ç½‘ç»œåˆ†æ" scheme="https://eatbreads.github.io/tags/%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90/"/>
    
    <category term="æŠ“åŒ…å·¥å…·" scheme="https://eatbreads.github.io/tags/%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>NginxåŸºç¡€é…ç½®ä¸ä½¿ç”¨æŒ‡å—</title>
    <link href="https://eatbreads.github.io/posts/8a38e9a9.html"/>
    <id>https://eatbreads.github.io/posts/8a38e9a9.html</id>
    <published>2025-05-03T14:59:43.000Z</published>
    <updated>2025-05-03T15:03:12.762Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è™½ç„¶æ˜¯å¾ˆä¹…ä»¥å‰åšçš„äº†-ä½†æ˜¯è¿˜æ˜¯è®°å½•ä¸€ä¸‹å§-å› ä¸ºäº”ä¸€æ²¡å­¦ä¹ æ²¡ä¸œè¥¿æ›´æ–°åšå®¢äº†-å˜»å˜»">è™½ç„¶æ˜¯å¾ˆä¹…ä»¥å‰åšçš„äº†,ä½†æ˜¯è¿˜æ˜¯è®°å½•ä¸€ä¸‹å§,å› ä¸ºäº”ä¸€æ²¡å­¦ä¹ æ²¡ä¸œè¥¿æ›´æ–°åšå®¢äº†(å˜»å˜»)</h3><h1>NginxåŸºç¡€é…ç½®ä¸ä½¿ç”¨æŒ‡å—</h1><h2 id="Nginxç®€ä»‹">Nginxç®€ä»‹</h2><p>Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„WebæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä»¥å…¶é«˜æ€§èƒ½ã€ç¨³å®šæ€§å’Œä½èµ„æºæ¶ˆè€—è€Œé—»åã€‚å®ƒå¯ä»¥ä½œä¸ºHTTPæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ”¯æŒè´Ÿè½½å‡è¡¡ç­‰é«˜çº§åŠŸèƒ½ã€‚</p><h2 id="åŸºæœ¬å‘½ä»¤">åŸºæœ¬å‘½ä»¤</h2><h3 id="1-æœåŠ¡ç®¡ç†">1. æœåŠ¡ç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨æœåŠ¡</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­æœåŠ¡</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯æœåŠ¡</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼˜é›…é€€å‡º</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -s quit</span><br></pre></td></tr></table></figure><h3 id="2-é…ç½®æ–‡ä»¶ç®¡ç†">2. é…ç½®æ–‡ä»¶ç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¾‘ä¸»é…ç½®æ–‡ä»¶</span></span><br><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹é”™è¯¯æ—¥å¿—</span></span><br><span class="line"><span class="built_in">tail</span> -f /usr/local/nginx/logs/error.log</span><br></pre></td></tr></table></figure><h2 id="é…ç½®è¯¦è§£">é…ç½®è¯¦è§£</h2><h3 id="1-åŸºç¡€é…ç½®ç»“æ„">1. åŸºç¡€é…ç½®ç»“æ„</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸»é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span> mime.types;</span><br><span class="line">    <span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åŒ…å«å…¶ä»–é…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="attribute">include</span> /usr/local/nginx/conf/conf.d/<span class="regexp">*.conf</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ç«™ç‚¹é…ç½®ç¤ºä¾‹">2. ç«™ç‚¹é…ç½®ç¤ºä¾‹</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> example.com;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç½‘ç«™æ ¹ç›®å½•</span></span><br><span class="line">    <span class="attribute">root</span> /var/www/html;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é»˜è®¤é¦–é¡µ</span></span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·¯å¾„é…ç½®</span></span><br><span class="line">    <span class="section">location</span> /admin &#123;</span><br><span class="line">        <span class="attribute">root</span> /var/www/admin;</span><br><span class="line">        <span class="attribute">index</span> index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-åå‘ä»£ç†é…ç½®">3. åå‘ä»£ç†é…ç½®</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /api &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://backend-server;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¸¸è§æ“ä½œæµç¨‹">å¸¸è§æ“ä½œæµç¨‹</h2><h3 id="1-æ·»åŠ æ–°ç«™ç‚¹">1. æ·»åŠ æ–°ç«™ç‚¹</h3><ol><li>åˆ›å»ºé…ç½®æ–‡ä»¶</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/conf.d/mysite.conf</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¼–å†™é…ç½®å†…å®¹</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> mysite.com;</span><br><span class="line">    <span class="attribute">root</span> /var/www/mysite;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>é‡æ–°åŠ è½½é…ç½®</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><h3 id="2-æ•…éšœæ’æŸ¥">2. æ•…éšœæ’æŸ¥</h3><ol><li>æ£€æŸ¥é…ç½®è¯­æ³•</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -t</span><br></pre></td></tr></table></figure><ol start="2"><li>æŸ¥çœ‹é”™è¯¯æ—¥å¿—</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f /usr/local/nginx/logs/error.log</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è®°å½•Nginxçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬æœåŠ¡ç®¡ç†ã€é…ç½®ä¿®æ”¹å’Œåå‘ä»£ç†è®¾ç½®</summary>
    
    
    
    <category term="è¿ç»´ç¬”è®°" scheme="https://eatbreads.github.io/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="æœåŠ¡å™¨" scheme="https://eatbreads.github.io/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="è¿ç»´" scheme="https://eatbreads.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="Nginx" scheme="https://eatbreads.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>åŒºå—é“¾é’±åŒ…åœ°å€ç”ŸæˆåŸç†</title>
    <link href="https://eatbreads.github.io/posts/fcfcdc9e.html"/>
    <id>https://eatbreads.github.io/posts/fcfcdc9e.html</id>
    <published>2025-05-02T13:22:27.000Z</published>
    <updated>2025-05-02T13:25:52.995Z</updated>
    
    <content type="html"><![CDATA[<h1>åŒºå—é“¾é’±åŒ…åœ°å€ç”ŸæˆåŸç†</h1><h2 id="åœ°å€ç”Ÿæˆæµç¨‹å›¾">åœ°å€ç”Ÿæˆæµç¨‹å›¾</h2><p><img src="https://cdn-a.markji.com/files/6814c7319209d5011496b4fd_hd.png?e=1746194770056&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:P1YSyOXLmo8LmVfo4AY8uqr87AA=" alt="é’±åŒ…åœ°å€ç”Ÿæˆæµç¨‹"></p><h2 id="å®ç°æ­¥éª¤">å®ç°æ­¥éª¤</h2><h3 id="1-ç”Ÿæˆéšæœºæ•°">1. ç”Ÿæˆéšæœºæ•°</h3><p>é¦–å…ˆéœ€è¦ç”Ÿæˆä¸€ä¸ªé«˜è´¨é‡çš„éšæœºæ•°ä½œä¸ºç§å­ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> rand::OsRng;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ“ä½œç³»ç»Ÿçº§åˆ«çš„éšæœºæ•°ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">rand</span> = rand::OsRng::<span class="title function_ invoke__">new</span>().<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†æ“ä½œç³»ç»Ÿæä¾›çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼Œå¯ä»¥ä¿è¯éšæœºæ•°çš„å®‰å…¨æ€§å’Œéšæœºæ€§ã€‚</p><h3 id="2-ç”Ÿæˆå¯†é’¥å¯¹">2. ç”Ÿæˆå¯†é’¥å¯¹</h3><p>ä½¿ç”¨Ed25519æ¤­åœ†æ›²çº¿ç®—æ³•ç”Ÿæˆå…¬ç§é’¥å¯¹ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> ed25519_dalek::&#123;Keypair, PublicKey, SecretKey&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line"><span class="keyword">let</span> (secret_key, public_key) = ed25519::<span class="title function_ invoke__">keypair</span>(&amp;key);</span><br></pre></td></tr></table></figure><p>Ed25519æ˜¯ä¸€ç§é«˜æ•ˆå®‰å…¨çš„æ¤­åœ†æ›²çº¿ç®—æ³•ï¼Œå¹¿æ³›åº”ç”¨äºåŒºå—é“¾å’ŒåŠ å¯†è´§å¸é¢†åŸŸã€‚</p><h3 id="3-å…¬é’¥å“ˆå¸ŒåŒ–">3. å…¬é’¥å“ˆå¸ŒåŒ–</h3><p>å¯¹å…¬é’¥è¿›è¡ŒSHA256å“ˆå¸Œè¿ç®—ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> sha2::&#123;Sha256, Digest&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºSHA256å“ˆå¸Œå™¨</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">hasher1</span> = Sha256::<span class="title function_ invoke__">new</span>();</span><br><span class="line"><span class="comment">// è¾“å…¥å…¬é’¥æ•°æ®</span></span><br><span class="line">hasher1.<span class="title function_ invoke__">input</span>(pubKey);</span><br><span class="line"><span class="comment">// è·å–å“ˆå¸Œç»“æœ</span></span><br><span class="line">hasher1.<span class="title function_ invoke__">result</span>(pubKey);</span><br></pre></td></tr></table></figure><p>å“ˆå¸ŒåŒ–å¯ä»¥ï¼š</p><ul><li>ç¼©çŸ­åœ°å€é•¿åº¦</li><li>æé«˜å®‰å…¨æ€§</li><li>å¢åŠ åœ°å€çš„å”¯ä¸€æ€§</li></ul><h3 id="4-Base58ç¼–ç ">4. Base58ç¼–ç </h3><p>å°†å“ˆå¸Œåçš„å…¬é’¥è½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ ¼å¼ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºåœ°å€ç»“æ„</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">address</span> = Address &#123;</span><br><span class="line">    body: pub_hash,</span><br><span class="line">    scheme: Scheme::Base58, <span class="comment">// ä½¿ç”¨Base58ç¼–ç </span></span><br><span class="line">    hash_type: HashType::Script,</span><br><span class="line">    ..<span class="built_in">Default</span>::<span class="title function_ invoke__">default</span>()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›è¡Œç¼–ç </span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">readable_address</span> = address.<span class="title function_ invoke__">encode</span>().<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure><p>Base58ç¼–ç çš„ç‰¹ç‚¹ï¼š</p><ul><li>é¿å…ä½¿ç”¨å®¹æ˜“æ··æ·†çš„å­—ç¬¦</li><li>ä¿æŒè¾ƒé«˜çš„ä¿¡æ¯å¯†åº¦</li><li>ä¾¿äºäººå·¥è¯†åˆ«å’Œè¾“å…¥</li></ul><h2 id="å®‰å…¨è€ƒè™‘">å®‰å…¨è€ƒè™‘</h2><ol><li><p><strong>éšæœºæ•°ç”Ÿæˆ</strong></p><ul><li>ä½¿ç”¨å¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨</li><li>é¿å…ä½¿ç”¨ä¼ªéšæœºæ•°</li><li>ç¡®ä¿ç†µå€¼å……è¶³</li></ul></li><li><p><strong>ç§é’¥ä¿æŠ¤</strong></p><ul><li>æ°¸è¿œä¸åœ¨ç½‘ç»œä¼ è¾“ç§é’¥</li><li>ä½¿ç”¨å®‰å…¨çš„å­˜å‚¨æ–¹å¼</li><li>è€ƒè™‘å¤šé‡ç­¾åæœºåˆ¶</li></ul></li><li><p><strong>åœ°å€æ ¡éªŒ</strong></p><ul><li>æ·»åŠ æ ¡éªŒå’Œ</li><li>éªŒè¯åœ°å€æ ¼å¼</li><li>é˜²æ­¢è¾“å…¥é”™è¯¯</li></ul></li></ol><h2 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</h2><ol><li><strong>å¯†é’¥ç®¡ç†</strong></li></ol><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®‰å…¨å­˜å‚¨ç§é’¥</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">encrypted_key</span> = <span class="title function_ invoke__">encrypt_key</span>(&amp;secret_key, password);</span><br><span class="line"><span class="title function_ invoke__">save_to_keystore</span>(&amp;encrypted_key);</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>åœ°å€éªŒè¯</strong></li></ol><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éªŒè¯åœ°å€æœ‰æ•ˆæ€§</span></span><br><span class="line"><span class="keyword">if</span> !address.<span class="title function_ invoke__">is_valid</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(<span class="string">&quot;Invalid address format&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>é”™è¯¯å¤„ç†</strong></li></ol><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®Œå–„çš„é”™è¯¯å¤„ç†</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">address</span> = <span class="keyword">match</span> Address::<span class="title function_ invoke__">new</span>(pub_hash) &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(addr) =&gt; addr,</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">handle_error</span>(e),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»åŒºå—é“¾é’±åŒ…åœ°å€çš„ç”Ÿæˆè¿‡ç¨‹ï¼ŒåŒ…æ‹¬éšæœºæ•°ç”Ÿæˆã€å¯†é’¥å¯¹åˆ›å»ºå’Œåœ°å€ç¼–ç </summary>
    
    
    
    <category term="åŒºå—é“¾å¼€å‘" scheme="https://eatbreads.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="åŒºå—é“¾" scheme="https://eatbreads.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    <category term="Rust" scheme="https://eatbreads.github.io/tags/Rust/"/>
    
    <category term="åŠ å¯†ç®—æ³•" scheme="https://eatbreads.github.io/tags/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>åŒºå—é“¾ç½‘ç»œé€šä¿¡æµç¨‹è¯¦è§£</title>
    <link href="https://eatbreads.github.io/posts/a56f3323.html"/>
    <id>https://eatbreads.github.io/posts/a56f3323.html</id>
    <published>2025-05-01T13:02:30.000Z</published>
    <updated>2025-05-01T13:06:32.072Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŒºå—é“¾ç½‘ç»œé€šä¿¡æµç¨‹è¯¦è§£"><a href="#åŒºå—é“¾ç½‘ç»œé€šä¿¡æµç¨‹è¯¦è§£" class="headerlink" title="åŒºå—é“¾ç½‘ç»œé€šä¿¡æµç¨‹è¯¦è§£"></a>åŒºå—é“¾ç½‘ç»œé€šä¿¡æµç¨‹è¯¦è§£</h1><h2 id="ç½‘ç»œé€šä¿¡æµç¨‹å›¾"><a href="#ç½‘ç»œé€šä¿¡æµç¨‹å›¾" class="headerlink" title="ç½‘ç»œé€šä¿¡æµç¨‹å›¾"></a>ç½‘ç»œé€šä¿¡æµç¨‹å›¾</h2><p><img src="https://cdn-a.markji.com/files/681371c72d056573630e9f46_hd.png?e=1746107367582&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:_6gQHn20mgVSAAOWAXrxm_fAnf4=" alt="åŒºå—é“¾ç½‘ç»œé€šä¿¡æµç¨‹"></p><h2 id="æ¥æ”¶æ–¹æµç¨‹"><a href="#æ¥æ”¶æ–¹æµç¨‹" class="headerlink" title="æ¥æ”¶æ–¹æµç¨‹"></a>æ¥æ”¶æ–¹æµç¨‹</h2><h3 id="1-å¯åŠ¨æœåŠ¡"><a href="#1-å¯åŠ¨æœåŠ¡" class="headerlink" title="1. å¯åŠ¨æœåŠ¡"></a>1. å¯åŠ¨æœåŠ¡</h3><ul><li>è°ƒç”¨ <code>startServer</code></li><li>å¼€å§‹ç›‘å¬ç½‘ç»œè¿æ¥</li><li>å‡†å¤‡æ¥æ”¶å…¶ä»–èŠ‚ç‚¹çš„è¯·æ±‚</li></ul><h3 id="2-ç‰ˆæœ¬å¤„ç†-handleVersion"><a href="#2-ç‰ˆæœ¬å¤„ç†-handleVersion" class="headerlink" title="2. ç‰ˆæœ¬å¤„ç† (handleVersion)"></a>2. ç‰ˆæœ¬å¤„ç† (handleVersion)</h3><ul><li>æ¥æ”¶ç‰ˆæœ¬ä¿¡æ¯</li><li>æ¯”è¾ƒåŒºå—é«˜åº¦<ul><li>å¦‚æœè‡ªèº«åŒºå—é“¾è¾ƒçŸ­ï¼šè¯·æ±‚è·å–æ–°å—</li><li>å¦‚æœè‡ªèº«åŒºå—é“¾è¾ƒé•¿ï¼šå‘é€versionç»™å¯¹æ–¹</li></ul></li><li>æ³¨æ„ï¼šå‘é€versionæ˜¯å‘èµ·åŒæ­¥è¯·æ±‚çš„æ–¹å¼</li></ul><h3 id="3-æ¸…å•å¤„ç†-handleInv"><a href="#3-æ¸…å•å¤„ç†-handleInv" class="headerlink" title="3. æ¸…å•å¤„ç† (handleInv)"></a>3. æ¸…å•å¤„ç† (handleInv)</h3><ul><li>æ¥æ”¶å‘é€æ–¹çš„Invæ¸…å•<ul><li>åŒ…å«å—ä¿¡æ¯å’Œäº¤æ˜“ä¿¡æ¯</li></ul></li><li>åˆ†ææ¸…å•å†…å®¹<ul><li>ç¡®å®šéœ€è¦ä¸‹è½½çš„å†…å®¹</li></ul></li><li>è°ƒç”¨getDataæ‰§è¡Œå®é™…ä¸‹è½½</li></ul><h3 id="4-åŒºå—å¤„ç†-handleBlock"><a href="#4-åŒºå—å¤„ç†-handleBlock" class="headerlink" title="4. åŒºå—å¤„ç† (handleBlock)"></a>4. åŒºå—å¤„ç† (handleBlock)</h3><ul><li>æ¥æ”¶æ–°åŒºå—</li><li>éªŒè¯åŒºå—æœ‰æ•ˆæ€§</li><li>å°†æ–°åŒºå—æ·»åŠ åˆ°æœ¬åœ°é“¾ä¸­</li><li>æ›´æ–°åŒºå—é“¾çŠ¶æ€</li></ul><h3 id="5-äº¤æ˜“å¤„ç†-handleTx"><a href="#5-äº¤æ˜“å¤„ç†-handleTx" class="headerlink" title="5. äº¤æ˜“å¤„ç† (handleTx)"></a>5. äº¤æ˜“å¤„ç† (handleTx)</h3><ul><li>æ¥æ”¶æ–°äº¤æ˜“</li><li>éªŒè¯äº¤æ˜“æœ‰æ•ˆæ€§</li><li>å°†äº¤æ˜“åŠ å…¥å†…å­˜æ± </li><li>å‡†å¤‡æ‰“åŒ…æ–°åŒºå—</li></ul><h2 id="å‘é€æ–¹æµç¨‹"><a href="#å‘é€æ–¹æµç¨‹" class="headerlink" title="å‘é€æ–¹æµç¨‹"></a>å‘é€æ–¹æµç¨‹</h2><h3 id="1-æœåŠ¡å¯åŠ¨"><a href="#1-æœåŠ¡å¯åŠ¨" class="headerlink" title="1. æœåŠ¡å¯åŠ¨"></a>1. æœåŠ¡å¯åŠ¨</h3><ul><li>è°ƒç”¨ <code>startServer</code></li><li>åˆå§‹åŒ–ç½‘ç»œæœåŠ¡</li><li>å‡†å¤‡å“åº”è¯·æ±‚</li></ul><h3 id="2-åŒºå—è·å–è¯·æ±‚å¤„ç†-handleGetBlock"><a href="#2-åŒºå—è·å–è¯·æ±‚å¤„ç†-handleGetBlock" class="headerlink" title="2. åŒºå—è·å–è¯·æ±‚å¤„ç† (handleGetBlock)"></a>2. åŒºå—è·å–è¯·æ±‚å¤„ç† (handleGetBlock)</h3><ul><li>æ¥æ”¶è·å–åŒºå—è¯·æ±‚</li><li>æŸ¥æ‰¾è¯·æ±‚çš„åŒºå—</li><li>å‡†å¤‡åŒºå—æ•°æ®</li><li>å‘é€åŒºå—ä¿¡æ¯</li></ul><h3 id="3-æ•°æ®è¯·æ±‚å¤„ç†-getData"><a href="#3-æ•°æ®è¯·æ±‚å¤„ç†-getData" class="headerlink" title="3. æ•°æ®è¯·æ±‚å¤„ç† (getData)"></a>3. æ•°æ®è¯·æ±‚å¤„ç† (getData)</h3><ul><li>æ¥æ”¶å…·ä½“æ•°æ®è¯·æ±‚</li><li>æ ¹æ®è¯·æ±‚ç±»å‹å¤„ç†<ul><li>åŒºå—è¯·æ±‚ï¼šè¿”å›å®Œæ•´åŒºå—</li><li>äº¤æ˜“è¯·æ±‚ï¼šè¿”å›äº¤æ˜“è¯¦æƒ…</li></ul></li><li>å‘é€è¯·æ±‚çš„æ•°æ®</li></ul><h2 id="é€šä¿¡è¦ç‚¹"><a href="#é€šä¿¡è¦ç‚¹" class="headerlink" title="é€šä¿¡è¦ç‚¹"></a>é€šä¿¡è¦ç‚¹</h2><ol><li><p><strong>ç‰ˆæœ¬åŒæ­¥æœºåˆ¶</strong></p><ul><li>é€šè¿‡versionæ¶ˆæ¯è¿›è¡ŒåŒºå—é“¾çŠ¶æ€åŒæ­¥</li><li>ç¡®ä¿èŠ‚ç‚¹é—´æ•°æ®ä¸€è‡´æ€§</li></ul></li><li><p><strong>æ•°æ®ä¼ è¾“æµç¨‹</strong></p><ul><li>Invæ¸…å•ä½œä¸ºæ•°æ®ç´¢å¼•</li><li>getDataè¯·æ±‚å…·ä½“æ•°æ®</li><li>åˆ†å—ä¼ è¾“é¿å…ç½‘ç»œæ‹¥å µ</li></ul></li><li><p><strong>çŠ¶æ€ç»´æŠ¤</strong></p><ul><li>è·Ÿè¸ªå¾…ä¸‹è½½çš„åŒºå—</li><li>ç®¡ç†äº¤æ˜“å†…å­˜æ± </li><li>ç»´æŠ¤èŠ‚ç‚¹è¿æ¥çŠ¶æ€</li></ul></li><li><p><strong>é”™è¯¯å¤„ç†</strong></p><ul><li>ç½‘ç»œæ–­å¼€é‡è¿</li><li>æ•°æ®éªŒè¯å¤±è´¥å¤„ç†</li><li>è¶…æ—¶é‡è¯•æœºåˆ¶</li></ul></li></ol><p>é€šè¿‡è¿™ç§è®¾è®¡ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¯é çš„P2Pç½‘ç»œé€šä¿¡æœºåˆ¶ï¼Œç¡®ä¿äº†åŒºå—é“¾ç½‘ç»œçš„æ­£å¸¸è¿è¡Œå’Œæ•°æ®åŒæ­¥ã€‚</p>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»åŒºå—é“¾P2Pç½‘ç»œä¸­èŠ‚ç‚¹é—´çš„é€šä¿¡æµç¨‹</summary>
    
    
    
    <category term="åŒºå—é“¾å¼€å‘" scheme="https://eatbreads.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="åŒºå—é“¾" scheme="https://eatbreads.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    <category term="ç½‘ç»œé€šä¿¡" scheme="https://eatbreads.github.io/tags/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/"/>
    
    <category term="æµç¨‹å›¾" scheme="https://eatbreads.github.io/tags/%E6%B5%81%E7%A8%8B%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>åŒºå—é“¾ç½‘ç»œéƒ¨åˆ†å®ç°</title>
    <link href="https://eatbreads.github.io/posts/5a225ca.html"/>
    <id>https://eatbreads.github.io/posts/5a225ca.html</id>
    <published>2025-04-30T15:32:26.000Z</published>
    <updated>2025-04-30T15:36:27.225Z</updated>
    
    <content type="html"><![CDATA[<h1>åŒºå—é“¾ç½‘ç»œå®ç°è¯¦è§£</h1><h2 id="ç½‘ç»œæ¶æ„">ç½‘ç»œæ¶æ„</h2><p>åŒºå—é“¾ç½‘ç»œé‡‡ç”¨P2Pï¼ˆç‚¹å¯¹ç‚¹ï¼‰æ‹“æ‰‘æ‰å¹³ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒæ—¶å…·å¤‡æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„åŒé‡èº«ä»½ã€‚è¿™ç§å»ä¸­å¿ƒåŒ–çš„æ¶æ„ç¡®ä¿äº†ç½‘ç»œçš„å¥å£®æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><h3 id="èŠ‚ç‚¹ç±»å‹">èŠ‚ç‚¹ç±»å‹</h3><ol><li><p><strong>çŸ¿å·¥èŠ‚ç‚¹</strong></p><ul><li>è´Ÿè´£æ‰“åŒ…äº¤æ˜“</li><li>è¿›è¡Œå·¥ä½œé‡è¯æ˜</li><li>å¹¿æ’­æ–°åŒºå—</li></ul></li><li><p><strong>å…¨èŠ‚ç‚¹</strong></p><ul><li>å­˜å‚¨å®Œæ•´çš„åŒºå—é“¾æ•°æ®</li><li>æä¾›ç½‘ç»œè·¯ç”±åŠŸèƒ½</li><li>éªŒè¯äº¤æ˜“å’ŒåŒºå—</li></ul></li><li><p><strong>SPVèŠ‚ç‚¹</strong>ï¼ˆç®€å•æ”¯ä»˜éªŒè¯ï¼‰</p><ul><li>åªå­˜å‚¨åŒºå—å¤´</li><li>ç»´æŠ¤ç‰¹å®šäº¤æ˜“å­é›†</li><li>è½»é‡çº§å®¢æˆ·ç«¯å®ç°</li></ul></li></ol><h2 id="ç½‘ç»œé€šä¿¡æµç¨‹">ç½‘ç»œé€šä¿¡æµç¨‹</h2><h3 id="1-ç‰ˆæœ¬éªŒè¯">1. ç‰ˆæœ¬éªŒè¯</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Versionæ¶ˆæ¯ç»“æ„</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Version</span> &#123;</span><br><span class="line">    version: <span class="type">i32</span>,</span><br><span class="line">    best_height: <span class="type">i32</span>,</span><br><span class="line">    addr_from: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-åŒºå—åŒæ­¥">2. åŒºå—åŒæ­¥</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetBlocksæ¶ˆæ¯ç»“æ„</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GetBlocks</span> &#123;</span><br><span class="line">    addr_from: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Invæ¶ˆæ¯ç»“æ„</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Inv</span> &#123;</span><br><span class="line">    addr_from: <span class="type">String</span>,</span><br><span class="line">    type_: <span class="type">String</span>,  <span class="comment">// &quot;block&quot; æˆ– &quot;tx&quot;</span></span><br><span class="line">    items: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-æ•°æ®è¯·æ±‚">3. æ•°æ®è¯·æ±‚</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetDataæ¶ˆæ¯ç»“æ„</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GetData</span> &#123;</span><br><span class="line">    addr_from: <span class="type">String</span>,</span><br><span class="line">    type_: <span class="type">String</span>,</span><br><span class="line">    id: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒç»„ä»¶å®ç°">æ ¸å¿ƒç»„ä»¶å®ç°</h2><h3 id="1-æœåŠ¡å™¨å¯åŠ¨">1. æœåŠ¡å™¨å¯åŠ¨</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">start_server</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">listener</span> = TcpListener::<span class="title function_ invoke__">bind</span>(&amp;<span class="keyword">self</span>.node_addr)?;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éä¸­å¿ƒèŠ‚ç‚¹éœ€è¦åŒæ­¥</span></span><br><span class="line">    <span class="keyword">if</span> !<span class="keyword">self</span>.is_central_node &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">send_version</span>(CENTRAL_NODE_ADDR);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸»å¾ªç¯å¤„ç†è¿æ¥</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">stream</span> <span class="keyword">in</span> listener.<span class="title function_ invoke__">incoming</span>() &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">handle_connection</span>(stream?);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-è¿æ¥å¤„ç†">2. è¿æ¥å¤„ç†</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">handle_connection</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, <span class="keyword">mut</span> stream: TcpStream) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">command</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">read_command</span>(&amp;<span class="keyword">mut</span> stream)?;</span><br><span class="line">    <span class="keyword">match</span> command.<span class="title function_ invoke__">as_str</span>() &#123;</span><br><span class="line">        <span class="string">&quot;version&quot;</span> =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">handle_version</span>(&amp;<span class="keyword">mut</span> stream),</span><br><span class="line">        <span class="string">&quot;getblocks&quot;</span> =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">handle_get_blocks</span>(&amp;<span class="keyword">mut</span> stream),</span><br><span class="line">        <span class="string">&quot;inv&quot;</span> =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">handle_inv</span>(&amp;<span class="keyword">mut</span> stream),</span><br><span class="line">        <span class="string">&quot;getdata&quot;</span> =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">handle_get_data</span>(&amp;<span class="keyword">mut</span> stream),</span><br><span class="line">        <span class="string">&quot;block&quot;</span> =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">handle_block</span>(&amp;<span class="keyword">mut</span> stream),</span><br><span class="line">        <span class="string">&quot;tx&quot;</span> =&gt; <span class="keyword">self</span>.<span class="title function_ invoke__">handle_tx</span>(&amp;<span class="keyword">mut</span> stream),</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Unknown command&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ç‰ˆæœ¬å¤„ç†">3. ç‰ˆæœ¬å¤„ç†</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">handle_version</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, stream: &amp;<span class="keyword">mut</span> TcpStream) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">version</span>: Version = <span class="title function_ invoke__">deserialize</span>(stream)?;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥åŒºå—é«˜åº¦</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>.blockchain.<span class="title function_ invoke__">get_best_height</span>() &lt; version.best_height &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">send_get_blocks</span>(version.addr_from);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-åŒºå—è¯·æ±‚å¤„ç†">4. åŒºå—è¯·æ±‚å¤„ç†</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">handle_get_blocks</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, stream: &amp;<span class="keyword">mut</span> TcpStream) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">payload</span>: GetBlocks = <span class="title function_ invoke__">deserialize</span>(stream)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">blocks</span> = <span class="keyword">self</span>.blockchain.<span class="title function_ invoke__">get_block_hashes</span>();</span><br><span class="line">    <span class="keyword">self</span>.<span class="title function_ invoke__">send_inv</span>(payload.addr_from, <span class="string">&quot;block&quot;</span>, blocks);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-æ¸…å•å¤„ç†">5. æ¸…å•å¤„ç†</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">handle_inv</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, stream: &amp;<span class="keyword">mut</span> TcpStream) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">inv</span>: Inv = <span class="title function_ invoke__">deserialize</span>(stream)?;</span><br><span class="line">    <span class="keyword">if</span> inv.type_ == <span class="string">&quot;block&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.blocks_in_transit = inv.items;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">send_get_data</span>(inv.addr_from, <span class="string">&quot;block&quot;</span>, <span class="keyword">self</span>.blocks_in_transit[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-æ•°æ®è¯·æ±‚å¤„ç†">6. æ•°æ®è¯·æ±‚å¤„ç†</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">handle_get_data</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, stream: &amp;<span class="keyword">mut</span> TcpStream) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">request</span>: GetData = <span class="title function_ invoke__">deserialize</span>(stream)?;</span><br><span class="line">    <span class="keyword">if</span> request.type_ == <span class="string">&quot;block&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">block</span> = <span class="keyword">self</span>.blockchain.<span class="title function_ invoke__">get_block</span>(&amp;request.id)?;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">send_block</span>(request.addr_from, block);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-åŒºå—å¤„ç†">7. åŒºå—å¤„ç†</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">handle_block</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, stream: &amp;<span class="keyword">mut</span> TcpStream) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">block</span>: Block = <span class="title function_ invoke__">deserialize</span>(stream)?;</span><br><span class="line">    <span class="keyword">self</span>.blockchain.<span class="title function_ invoke__">add_block</span>(block)?;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»§ç»­è¯·æ±‚å…¶ä»–åŒºå—</span></span><br><span class="line">    <span class="keyword">if</span> !<span class="keyword">self</span>.blocks_in_transit.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">        <span class="keyword">self</span>.blocks_in_transit.<span class="title function_ invoke__">remove</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> !<span class="keyword">self</span>.blocks_in_transit.<span class="title function_ invoke__">is_empty</span>() &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">next_hash</span> = <span class="keyword">self</span>.blocks_in_transit[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">self</span>.<span class="title function_ invoke__">send_get_data</span>(stream.<span class="title function_ invoke__">peer_addr</span>()?, <span class="string">&quot;block&quot;</span>, next_hash);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-äº¤æ˜“å¤„ç†">8. äº¤æ˜“å¤„ç†</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">handle_tx</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, stream: &amp;<span class="keyword">mut</span> TcpStream) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tx</span>: Transaction = <span class="title function_ invoke__">deserialize</span>(stream)?;</span><br><span class="line">    <span class="keyword">self</span>.mempool.<span class="title function_ invoke__">insert</span>(tx.id.<span class="title function_ invoke__">clone</span>(), tx);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½œä¸ºçŸ¿å·¥èŠ‚ç‚¹ï¼Œæ”¶é›†è¶³å¤Ÿäº¤æ˜“åå¼€å§‹æŒ–çŸ¿</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>.is_miner &amp;&amp; <span class="keyword">self</span>.mempool.<span class="title function_ invoke__">len</span>() &gt;= MINING_THRESHOLD &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">txs</span>: <span class="type">Vec</span>&lt;Transaction&gt; = <span class="keyword">self</span>.mempool.<span class="title function_ invoke__">values</span>().<span class="title function_ invoke__">cloned</span>().<span class="title function_ invoke__">collect</span>();</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">mine_block</span>(txs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»åŒºå—é“¾P2Pç½‘ç»œçš„å®ç°åŸç†å’Œæ ¸å¿ƒç»„ä»¶</summary>
    
    
    
    <category term="åŒºå—é“¾å¼€å‘" scheme="https://eatbreads.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="åŒºå—é“¾" scheme="https://eatbreads.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    <category term="Rust" scheme="https://eatbreads.github.io/tags/Rust/"/>
    
    <category term="P2Pç½‘ç»œ" scheme="https://eatbreads.github.io/tags/P2P%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>Pythonè°ƒç”¨å¤§æ¨¡å‹APIå®æˆ˜</title>
    <link href="https://eatbreads.github.io/posts/ffa1ef1b.html"/>
    <id>https://eatbreads.github.io/posts/ffa1ef1b.html</id>
    <published>2025-04-30T15:17:28.000Z</published>
    <updated>2025-04-30T15:26:00.791Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Pythonè°ƒç”¨å¤§æ¨¡å‹APIå®æˆ˜æ•™ç¨‹"><a href="#Pythonè°ƒç”¨å¤§æ¨¡å‹APIå®æˆ˜æ•™ç¨‹" class="headerlink" title="Pythonè°ƒç”¨å¤§æ¨¡å‹APIå®æˆ˜æ•™ç¨‹"></a>Pythonè°ƒç”¨å¤§æ¨¡å‹APIå®æˆ˜æ•™ç¨‹</h1><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>é¦–å…ˆéœ€è¦å®‰è£…openaiåº“ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install openai</span><br></pre></td></tr></table></figure></p><h2 id="APIç”³è¯·"><a href="#APIç”³è¯·" class="headerlink" title="APIç”³è¯·"></a>APIç”³è¯·</h2><ol><li>è®¿é—® Deepseek å®˜ç½‘æ³¨å†Œè´¦å·</li><li>åœ¨ä¸ªäººä¸­å¿ƒç”³è¯· API Key</li><li>è·å–åˆ°å½¢å¦‚ <code>sk-0f2245****a0bb3f1e</code> çš„å¯†é’¥</li><li>å……å€¼ä»¥è·å¾—APIè°ƒç”¨é¢åº¦</li></ol><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="1-åŸºç¡€é…ç½®"><a href="#1-åŸºç¡€é…ç½®" class="headerlink" title="1. åŸºç¡€é…ç½®"></a>1. åŸºç¡€é…ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºOpenAIå®¢æˆ·ç«¯</span></span><br><span class="line">client = OpenAI(</span><br><span class="line">    api_key=<span class="string">&quot;your-api-key&quot;</span>,  <span class="comment"># æ›¿æ¢ä¸ºä½ çš„APIå¯†é’¥</span></span><br><span class="line">    base_url=<span class="string">&quot;https://api.deepseek.com/v1&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="2-å®šä¹‰Promptæ¨¡æ¿"><a href="#2-å®šä¹‰Promptæ¨¡æ¿" class="headerlink" title="2. å®šä¹‰Promptæ¨¡æ¿"></a>2. å®šä¹‰Promptæ¨¡æ¿</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PROMPT_TEMPLATES = &#123;</span><br><span class="line">    <span class="string">&quot;student_info&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;system&quot;</span>: <span class="string">&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªä¸“æ³¨äºå­¦ç”ŸåŸºæœ¬ä¿¡æ¯åˆ†æçš„æ•™è‚²æ•°æ®ä¸“å®¶ã€‚</span></span><br><span class="line"><span class="string">        - æ“…é•¿å¤„ç†å­¦ç”Ÿä¸ªäººä¿¡æ¯ã€äººå£ç»Ÿè®¡å­¦ç‰¹å¾</span></span><br><span class="line"><span class="string">        - æ³¨é‡å­¦ç”Ÿä¿¡æ¯çš„éšç§ä¿æŠ¤</span></span><br><span class="line"><span class="string">        - ä¸“æ³¨äºäººå£ç‰¹å¾ç»Ÿè®¡å’Œåˆ†å¸ƒåˆ†æ&quot;&quot;&quot;</span>,</span><br><span class="line">        </span><br><span class="line">        <span class="string">&quot;background&quot;</span>: <span class="string">&quot;&quot;&quot;æ­£åœ¨åˆ†æå­¦ç”ŸåŸºæœ¬ä¿¡æ¯æ•°æ®ï¼š</span></span><br><span class="line"><span class="string">        - æ•°æ®ç±»å‹ï¼šå­¦ç”Ÿä¸ªäººåŸºæœ¬ä¿¡æ¯</span></span><br><span class="line"><span class="string">        - åŒ…å«å­—æ®µï¼šå­¦å·ã€å§“åã€æ€§åˆ«ã€å¹´é¾„ã€ç±è´¯ç­‰</span></span><br><span class="line"><span class="string">        - åˆ†æç›®æ ‡ï¼šäº†è§£å­¦ç”Ÿç¾¤ä½“çš„åŸºæœ¬ç‰¹å¾åˆ†å¸ƒ&quot;&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># ... å…¶ä»–æ¨¡æ¿</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-æ•°æ®è¯»å–å‡½æ•°"><a href="#3-æ•°æ®è¯»å–å‡½æ•°" class="headerlink" title="3. æ•°æ®è¯»å–å‡½æ•°"></a>3. æ•°æ®è¯»å–å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read_data_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¯»å–æ•°æ®æ–‡ä»¶&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> file_path.endswith(<span class="string">&#x27;.csv&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> pd.read_csv(file_path)</span><br><span class="line">    <span class="keyword">elif</span> file_path.endswith(<span class="string">&#x27;.xlsx&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> pd.read_excel(file_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œè¯·ä½¿ç”¨ CSV æˆ– Excel æ–‡ä»¶&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="4-åˆ›å»ºåˆ†æè¯·æ±‚"><a href="#4-åˆ›å»ºåˆ†æè¯·æ±‚" class="headerlink" title="4. åˆ›å»ºåˆ†æè¯·æ±‚"></a>4. åˆ›å»ºåˆ†æè¯·æ±‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create_analysis_request</span>(<span class="params">data_type, specific_task, data_file=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åˆ›å»ºå¹¶å‘é€åˆ†æè¯·æ±‚&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> data_type <span class="keyword">not</span> <span class="keyword">in</span> PROMPT_TEMPLATES:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f&quot;ä¸æ”¯æŒçš„æ•°æ®ç±»å‹: <span class="subst">&#123;data_type&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    template = PROMPT_TEMPLATES[data_type]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ·»åŠ æ•°æ®æ¦‚è§ˆ</span></span><br><span class="line">    data_overview = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> data_file:</span><br><span class="line">        df = read_data_file(data_file)</span><br><span class="line">        data_overview = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        æ•°æ®æ¦‚è§ˆï¼š</span></span><br><span class="line"><span class="string">        - æ€»è®°å½•æ•°ï¼š<span class="subst">&#123;<span class="built_in">len</span>(df)&#125;</span></span></span><br><span class="line"><span class="string">        - å­—æ®µåˆ—è¡¨ï¼š<span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(df.columns)&#125;</span></span></span><br><span class="line"><span class="string">        - æ•°æ®ç¤ºä¾‹ï¼š\n<span class="subst">&#123;df.head(<span class="number">3</span>).to_string()&#125;</span></span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å‘é€è¯·æ±‚</span></span><br><span class="line">    response = client.chat.completions.create(</span><br><span class="line">        model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">        messages=[</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: template[<span class="string">&quot;system&quot;</span>]&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: template[<span class="string">&quot;background&quot;</span>] + data_overview&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: specific_task&#125;</span><br><span class="line">        ],</span><br><span class="line">        temperature=<span class="number">0.3</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> response.choices[<span class="number">0</span>].message.content</span><br></pre></td></tr></table></figure><h3 id="5-ä½¿ç”¨ç¤ºä¾‹"><a href="#5-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="5. ä½¿ç”¨ç¤ºä¾‹"></a>5. ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰åˆ†æä»»åŠ¡</span></span><br><span class="line">specific_task = <span class="string">&quot;&quot;&quot;è¯·åˆ†æä»¥ä¸‹å†…å®¹ï¼š</span></span><br><span class="line"><span class="string">1. æ•°æ®å®Œæ•´æ€§æ£€æŸ¥</span></span><br><span class="line"><span class="string">2. ä¸»è¦æŒ‡æ ‡çš„åˆ†å¸ƒæƒ…å†µ</span></span><br><span class="line"><span class="string">3. å¼‚å¸¸å€¼æ£€æµ‹å’Œå¤„ç†å»ºè®®</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¾“å‡ºè¦æ±‚ï¼š</span></span><br><span class="line"><span class="string">- æ ¼å¼ï¼šåˆ†ç‚¹åˆ—å‡º</span></span><br><span class="line"><span class="string">- åŒ…å«å…·ä½“æ•°å€¼å’Œç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="string">- æä¾›å¯è§†åŒ–å»ºè®®&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œåˆ†æ</span></span><br><span class="line">file_path = <span class="string">&quot;path/to/your/data.xlsx&quot;</span></span><br><span class="line">analysis_result = create_analysis_request(<span class="string">&quot;student_info&quot;</span>, specific_task, file_path)</span><br><span class="line"><span class="built_in">print</span>(analysis_result)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Pythonè°ƒç”¨å¤§æ¨¡å‹APIï¼ŒåŒ…æ‹¬ç¯å¢ƒé…ç½®ã€APIç”³è¯·å’Œä»£ç å®ç°</summary>
    
    
    
    <category term="ç¼–ç¨‹å¼€å‘" scheme="https://eatbreads.github.io/categories/%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Python" scheme="https://eatbreads.github.io/tags/Python/"/>
    
    <category term="AI" scheme="https://eatbreads.github.io/tags/AI/"/>
    
    <category term="APIè°ƒç”¨" scheme="https://eatbreads.github.io/tags/API%E8%B0%83%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>Rustå‘½ä»¤è¡Œå‚æ•°è§£æ - clapåº“ä½¿ç”¨æŒ‡å—</title>
    <link href="https://eatbreads.github.io/posts/6d327ffd.html"/>
    <id>https://eatbreads.github.io/posts/6d327ffd.html</id>
    <published>2025-04-28T05:45:27.000Z</published>
    <updated>2025-04-28T05:46:42.298Z</updated>
    
    <content type="html"><![CDATA[<h1>Rustå‘½ä»¤è¡Œå‚æ•°è§£æï¼šclapåº“ä½¿ç”¨æŒ‡å—</h1><h2 id="ç®€ä»‹">ç®€ä»‹</h2><p>clap (Command Line Argument Parser) æ˜¯Rustç”Ÿæ€ç³»ç»Ÿä¸­æœ€æµè¡Œçš„å‘½ä»¤è¡Œå‚æ•°è§£æåº“ä¹‹ä¸€ã€‚å®ƒæä¾›äº†ç›´è§‚çš„APIå’Œä¸°å¯Œçš„åŠŸèƒ½ï¼Œä½¿å¾—æ„å»ºå‘½ä»¤è¡Œåº”ç”¨å˜å¾—ç®€å•ã€‚</p><h2 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h2><h3 id="1-æ·»åŠ ä¾èµ–">1. æ·»åŠ ä¾èµ–</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">clap</span> = <span class="string">&quot;2.33&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2-åˆ›å»ºå‘½ä»¤è¡Œåº”ç”¨">2. åˆ›å»ºå‘½ä»¤è¡Œåº”ç”¨</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> clap::&#123;App, Arg&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">app</span> = App::<span class="title function_ invoke__">new</span>(<span class="string">&quot;blockchain-demo&quot;</span>)    <span class="comment">// åº”ç”¨åç§°</span></span><br><span class="line">        .<span class="title function_ invoke__">version</span>(<span class="string">&quot;0.1&quot;</span>)                      <span class="comment">// ç‰ˆæœ¬å·</span></span><br><span class="line">        .<span class="title function_ invoke__">author</span>(<span class="string">&quot;Your Name&quot;</span>)                 <span class="comment">// ä½œè€…ä¿¡æ¯</span></span><br><span class="line">        .<span class="title function_ invoke__">about</span>(<span class="string">&quot;åŒºå—é“¾æ¼”ç¤ºç¨‹åº&quot;</span>);            <span class="comment">// åº”ç”¨æè¿°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-æ·»åŠ å­å‘½ä»¤">3. æ·»åŠ å­å‘½ä»¤</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">app</span> = App::<span class="title function_ invoke__">new</span>(<span class="string">&quot;blockchain-demo&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">version</span>(<span class="string">&quot;0.1&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">author</span>(<span class="string">&quot;Your Name&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">about</span>(<span class="string">&quot;åŒºå—é“¾æ¼”ç¤ºç¨‹åº&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">subcommand</span>(App::<span class="title function_ invoke__">new</span>(<span class="string">&quot;printchain&quot;</span>))      <span class="comment">// æ·»åŠ æ— å‚æ•°å­å‘½ä»¤</span></span><br><span class="line">    .<span class="title function_ invoke__">subcommand</span>(</span><br><span class="line">        App::<span class="title function_ invoke__">new</span>(<span class="string">&quot;addblock&quot;</span>)                 <span class="comment">// æ·»åŠ å¸¦å‚æ•°å­å‘½ä»¤</span></span><br><span class="line">            .<span class="title function_ invoke__">arg</span>(Arg::<span class="title function_ invoke__">from_usage</span>(<span class="string">&quot;&lt;data&gt; &#x27;the blockchain data&#x27;&quot;</span>))</span><br><span class="line">    );</span><br></pre></td></tr></table></figure><h3 id="4-è§£æå‚æ•°">4. è§£æå‚æ•°</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">matches</span> = app.<span class="title function_ invoke__">get_matches</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥å­å‘½ä»¤</span></span><br><span class="line">    <span class="keyword">match</span> matches.<span class="title function_ invoke__">subcommand</span>() &#123;</span><br><span class="line">        (<span class="string">&quot;printchain&quot;</span>, <span class="title function_ invoke__">Some</span>(_)) =&gt; &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†printchainå‘½ä»¤</span></span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;æ‰“å°åŒºå—é“¾&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        (<span class="string">&quot;addblock&quot;</span>, <span class="title function_ invoke__">Some</span>(add_matches)) =&gt; &#123;</span><br><span class="line">            <span class="comment">// è·å–dataå‚æ•°</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(data) = add_matches.<span class="title function_ invoke__">value_of</span>(<span class="string">&quot;data&quot;</span>) &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;æ·»åŠ åŒºå—: &#123;&#125;&quot;</span>, data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        _ =&gt; <span class="built_in">println!</span>(<span class="string">&quot;æœªçŸ¥å‘½ä»¤&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚æ•°å¤„ç†æ–¹æ³•">å‚æ•°å¤„ç†æ–¹æ³•</h2><h3 id="1-æ£€æŸ¥å­å‘½ä»¤">1. æ£€æŸ¥å­å‘½ä»¤</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> matches) = matches.<span class="title function_ invoke__">subcommand_matches</span>(<span class="string">&quot;addblock&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†addblockå­å‘½ä»¤</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-è·å–å‚æ•°å€¼">2. è·å–å‚æ•°å€¼</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(value) = matches.<span class="title function_ invoke__">value_of</span>(<span class="string">&quot;å‚æ•°å&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨å‚æ•°å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-è·å–å¤šå€¼å‚æ•°">3. è·å–å¤šå€¼å‚æ•°</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(values) = matches.<span class="title function_ invoke__">values_of</span>(<span class="string">&quot;å‚æ•°å&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">value</span> <span class="keyword">in</span> values &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ¯ä¸ªå€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‘½ä»¤è¡Œä½¿ç”¨ç¤ºä¾‹">å‘½ä»¤è¡Œä½¿ç”¨ç¤ºä¾‹</h2><h3 id="æŸ¥çœ‹å¸®åŠ©">æŸ¥çœ‹å¸®åŠ©</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo run -- --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">blockchain-demo 0.1</span><br><span class="line">Your Name</span><br><span class="line">åŒºå—é“¾æ¼”ç¤ºç¨‹åº</span><br><span class="line"></span><br><span class="line">USAGE:</span><br><span class="line">    blockchain-demo [SUBCOMMAND]</span><br><span class="line"></span><br><span class="line">FLAGS:</span><br><span class="line">    -h, <span class="params">--help</span>       Prints <span class="keyword">help</span> information</span><br><span class="line">    -V, <span class="params">--version</span>    Prints <span class="keyword">version</span> information</span><br><span class="line"></span><br><span class="line">SUBCOMMANDS:</span><br><span class="line">    addblock     </span><br><span class="line">    <span class="keyword">help</span>         Prints this message or the <span class="keyword">help</span> of the given subcommand<span class="params">(s)</span></span><br><span class="line">    printchain</span><br></pre></td></tr></table></figure><h3 id="æ‰§è¡Œå­å‘½ä»¤">æ‰§è¡Œå­å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰“å°åŒºå—é“¾</span></span><br><span class="line">cargo run -- printchain</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ åŒºå—</span></span><br><span class="line">cargo run -- addblock <span class="string">&quot;è¿™æ˜¯ç¬¬ä¸€ä¸ªåŒºå—çš„æ•°æ®&quot;</span></span><br></pre></td></tr></table></figure><h2 id="é«˜çº§ç‰¹æ€§">é«˜çº§ç‰¹æ€§</h2><h3 id="1-å‚æ•°éªŒè¯">1. å‚æ•°éªŒè¯</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_ invoke__">arg</span>(Arg::<span class="title function_ invoke__">with_name</span>(<span class="string">&quot;count&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">short</span>(<span class="string">&quot;c&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">long</span>(<span class="string">&quot;count&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">takes_value</span>(<span class="literal">true</span>)</span><br><span class="line">    .<span class="title function_ invoke__">validator</span>(|s| &#123;</span><br><span class="line">        s.parse::&lt;<span class="type">i32</span>&gt;()</span><br><span class="line">            .<span class="title function_ invoke__">map</span>(|_| ())</span><br><span class="line">            .<span class="title function_ invoke__">map_err</span>(|_| <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;å¿…é¡»æ˜¯æ•°å­—&quot;</span>))</span><br><span class="line">    &#125;))</span><br></pre></td></tr></table></figure><h3 id="2-é»˜è®¤å€¼">2. é»˜è®¤å€¼</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_ invoke__">arg</span>(Arg::<span class="title function_ invoke__">with_name</span>(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">long</span>(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">default_value</span>(<span class="string">&quot;default&quot;</span>))</span><br></pre></td></tr></table></figure><h3 id="3-å‚æ•°ç»„">3. å‚æ•°ç»„</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_ invoke__">args_group</span>(ArgGroup::<span class="title function_ invoke__">with_name</span>(<span class="string">&quot;group&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">args</span>(&amp;[<span class="string">&quot;arg1&quot;</span>, <span class="string">&quot;arg2&quot;</span>])</span><br><span class="line">    .<span class="title function_ invoke__">required</span>(<span class="literal">true</span>))</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">è¯¦ç»†ä»‹ç»Rustä¸­ä½¿ç”¨clapåº“è¿›è¡Œå‘½ä»¤è¡Œå‚æ•°è§£æçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬åŸºæœ¬é…ç½®ã€å‚æ•°å®šä¹‰å’Œä½¿ç”¨ç¤ºä¾‹</summary>
    
    
    
    <category term="åç«¯å¼€å‘" scheme="https://eatbreads.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="Rust" scheme="https://eatbreads.github.io/tags/Rust/"/>
    
    <category term="å¼€å‘å·¥å…·" scheme="https://eatbreads.github.io/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
    <category term="CLI" scheme="https://eatbreads.github.io/tags/CLI/"/>
    
  </entry>
  
  <entry>
    <title>Sled - Rustçš„åµŒå…¥å¼é”®å€¼æ•°æ®åº“</title>
    <link href="https://eatbreads.github.io/posts/4e9334eb.html"/>
    <id>https://eatbreads.github.io/posts/4e9334eb.html</id>
    <published>2025-04-28T05:43:26.000Z</published>
    <updated>2025-04-28T05:44:49.167Z</updated>
    
    <content type="html"><![CDATA[<h1>Sledç®€ä»‹</h1><p>Sledæ˜¯ä¸€ä¸ªç”¨çº¯Rustå®ç°çš„åµŒå…¥å¼é”®å€¼æ•°æ®åº“ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>çº¯Rustå®ç°ï¼Œä¿è¯å†…å­˜å®‰å…¨</li><li>åµŒå…¥å¼è®¾è®¡ï¼Œæ— éœ€ç‹¬ç«‹æœåŠ¡å™¨</li><li>ç±»Redisçš„é”®å€¼å¯¹å­˜å‚¨</li><li>æœ¬åœ°æ–‡ä»¶æŒä¹…åŒ–</li><li>é«˜æ€§èƒ½å’Œå¯é æ€§</li></ul><h2 id="ä¸ä¼ ç»Ÿæ•°æ®åº“çš„åŒºåˆ«">ä¸ä¼ ç»Ÿæ•°æ®åº“çš„åŒºåˆ«</h2><h3 id="ä¼ ç»Ÿæ•°æ®åº“-å¦‚MySQL">ä¼ ç»Ÿæ•°æ®åº“(å¦‚MySQL)</h3><ul><li>éœ€è¦ç‹¬ç«‹çš„æ•°æ®åº“æœåŠ¡å™¨</li><li>éœ€è¦å¼€æ”¾ç½‘ç»œç«¯å£</li><li>å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„</li><li>æ”¯æŒå¤æ‚çš„SQLæŸ¥è¯¢</li></ul><h3 id="åµŒå…¥å¼æ•°æ®åº“-å¦‚Sled">åµŒå…¥å¼æ•°æ®åº“(å¦‚Sled)</h3><ul><li>ç›´æ¥åµŒå…¥åº”ç”¨ç¨‹åº</li><li>ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å­˜å‚¨</li><li>æ— éœ€ç½‘ç»œè¿æ¥</li><li>ç®€å•çš„é”®å€¼å¯¹æ“ä½œ</li></ul><h2 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h2><h3 id="1-æ·»åŠ ä¾èµ–">1. æ·»åŠ ä¾èµ–</h3><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">sled</span> = <span class="string">&quot;0.34&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2-æ‰“å¼€æ•°æ®åº“">2. æ‰“å¼€æ•°æ®åº“</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> sled::Db;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> sled::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="comment">// æ‰“å¼€æ•°æ®åº“ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">db</span> = sled::<span class="title function_ invoke__">open</span>(<span class="string">&quot;data/blocks&quot;</span>)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-åŸºæœ¬æ“ä½œ">3. åŸºæœ¬æ“ä½œ</h3><h4 id="å­˜å‚¨æ•°æ®">å­˜å‚¨æ•°æ®</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ’å…¥é”®å€¼å¯¹</span></span><br><span class="line">db.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>)?;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å­—èŠ‚æ•°ç»„</span></span><br><span class="line">db.<span class="title function_ invoke__">insert</span>(<span class="string">b&quot;key&quot;</span>, <span class="string">b&quot;value&quot;</span>)?;</span><br></pre></td></tr></table></figure><h4 id="è¯»å–æ•°æ®">è¯»å–æ•°æ®</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å€¼</span></span><br><span class="line"><span class="keyword">match</span> db.<span class="title function_ invoke__">get</span>(<span class="string">&quot;key&quot;</span>)? &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(value) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;æ‰¾åˆ°å€¼: &#123;:?&#125;&quot;</span>, value),</span><br><span class="line">    <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;æœªæ‰¾åˆ°å€¼&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ é™¤é”®å€¼å¯¹</span></span><br><span class="line">db.<span class="title function_ invoke__">remove</span>(<span class="string">&quot;key&quot;</span>)?;</span><br></pre></td></tr></table></figure><h4 id="æŒä¹…åŒ–">æŒä¹…åŒ–</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¡®ä¿æ•°æ®å†™å…¥ç£ç›˜</span></span><br><span class="line">db.<span class="title function_ invoke__">flush</span>()?;</span><br></pre></td></tr></table></figure><h2 id="é«˜çº§ç‰¹æ€§">é«˜çº§ç‰¹æ€§</h2><h3 id="1-åŸå­æ“ä½œ">1. åŸå­æ“ä½œ</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯”è¾ƒå¹¶è®¾ç½®</span></span><br><span class="line">db.<span class="title function_ invoke__">compare_and_swap</span>(<span class="string">&quot;key&quot;</span>, <span class="title function_ invoke__">Some</span>(<span class="string">&quot;old&quot;</span>), <span class="title function_ invoke__">Some</span>(<span class="string">&quot;new&quot;</span>))?;</span><br></pre></td></tr></table></figure><h3 id="2-æ‰¹é‡æ“ä½œ">2. æ‰¹é‡æ“ä½œ</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">batch</span> = sled::Batch::<span class="title function_ invoke__">default</span>()</span><br><span class="line">    .<span class="title function_ invoke__">insert</span>(<span class="string">b&quot;k1&quot;</span>, <span class="string">b&quot;v1&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">insert</span>(<span class="string">b&quot;k2&quot;</span>, <span class="string">b&quot;v2&quot;</span>)</span><br><span class="line">    .<span class="title function_ invoke__">remove</span>(<span class="string">b&quot;k3&quot;</span>);</span><br><span class="line">db.<span class="title function_ invoke__">apply_batch</span>(batch)?;</span><br></pre></td></tr></table></figure><h3 id="3-äº‹åŠ¡æ”¯æŒ">3. äº‹åŠ¡æ”¯æŒ</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">tree</span> = db.<span class="title function_ invoke__">open_tree</span>(<span class="string">&quot;my_tree&quot;</span>)?;</span><br><span class="line">tree.<span class="title function_ invoke__">transaction</span>(|tree| &#123;</span><br><span class="line">    tree.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>)?;</span><br><span class="line">    tree.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;key2&quot;</span>, <span class="string">&quot;value2&quot;</span>)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;)?;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä»‹ç»Rustç”Ÿæ€ä¸­çš„åµŒå…¥å¼é”®å€¼æ•°æ®åº“Sledï¼ŒåŒ…æ‹¬å…¶åŸºæœ¬æ¦‚å¿µã€ç‰¹æ€§ä»¥åŠå¸¸ç”¨æ“ä½œæ–¹æ³•</summary>
    
    
    
    <category term="åç«¯å¼€å‘" scheme="https://eatbreads.github.io/categories/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="æ•°æ®åº“" scheme="https://eatbreads.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Rust" scheme="https://eatbreads.github.io/tags/Rust/"/>
    
    <category term="åµŒå…¥å¼" scheme="https://eatbreads.github.io/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>GitHub READMEä¸­çš„ä¾¿æ·è·³è½¬åŠŸèƒ½ä»‹ç»</title>
    <link href="https://eatbreads.github.io/posts/e16aa73e.html"/>
    <id>https://eatbreads.github.io/posts/e16aa73e.html</id>
    <published>2025-04-26T14:22:30.000Z</published>
    <updated>2025-04-26T14:24:04.213Z</updated>
    
    <content type="html"><![CDATA[<h1>GitHub READMEä¸­çš„ä¾¿æ·è·³è½¬åŠŸèƒ½</h1><p>åœ¨GitHubé¡¹ç›®å¼€å‘ä¸­ï¼ŒREADMEæ–‡ä»¶ä¸ä»…ä»…æ˜¯é¡¹ç›®çš„è¯´æ˜ä¹¦ï¼Œè¿˜å¯ä»¥ä½œä¸ºé¡¹ç›®å¼€å‘å†ç¨‹çš„å¯¼èˆªã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨READMEä¸­å®ç°ä¾¿æ·çš„ä»£ç ç‰ˆæœ¬è·³è½¬åŠŸèƒ½ã€‚</p><h2 id="åŸºæœ¬è¯­æ³•">åŸºæœ¬è¯­æ³•</h2><h3 id="1-åˆ†æ”¯è·³è½¬">1. åˆ†æ”¯è·³è½¬</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">åˆ†æ”¯åç§°</span>](<span class="link">https://github.com/ç”¨æˆ·å/ä»“åº“å/tree/åˆ†æ”¯å</span>)</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">åˆå§‹æäº¤</span>](<span class="link">https://github.com/eatbreads/bitcoin_demo/tree/initial</span>)</span><br></pre></td></tr></table></figure><h3 id="2-ç‰¹å®šcommitè·³è½¬">2. ç‰¹å®šcommitè·³è½¬</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">commitæè¿°</span>](<span class="link">https://github.com/ç”¨æˆ·å/ä»“åº“å/tree/commitå“ˆå¸Œ</span>)</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">commit eb822486</span>](<span class="link">https://github.com/eatbreads/bitcoin_demo/tree/eb822486</span>)</span><br></pre></td></tr></table></figure><h2 id="å®é™…åº”ç”¨ç¤ºä¾‹">å®é™…åº”ç”¨ç¤ºä¾‹</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŒºå—é“¾é¡¹ç›®çš„å¼€å‘é˜¶æ®µè¯´æ˜ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## å¼€å‘é˜¶æ®µ</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> part1: Basic Prototype <span class="code">`åŸºæœ¬åŸå‹`</span>              </span><br><span class="line">   [<span class="string">åˆå§‹æäº¤</span>](<span class="link">https://github.com/eatbreads/bitcoin_demo/tree/initial</span>)</span><br><span class="line"><span class="bullet">   -</span> å®ç°åŒºå—ç»“æ„</span><br><span class="line"><span class="bullet">   -</span> å®ç°åŸºç¡€åŒºå—é“¾</span><br><span class="line"><span class="bullet">   -</span> åˆ›ä¸–åŒºå—ç”Ÿæˆ</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> part2: Proof-of-Work <span class="code">`å·¥ä½œé‡è¯æ˜`</span>            </span><br><span class="line">   [<span class="string">commit eb822486</span>](<span class="link">https://github.com/eatbreads/bitcoin_demo/tree/eb822486</span>)</span><br><span class="line"><span class="bullet">   -</span> å®ç°å·¥ä½œé‡è¯æ˜ç®—æ³•</span><br><span class="line"><span class="bullet">   -</span> æ·»åŠ æŒ–çŸ¿åŠŸèƒ½</span><br><span class="line"><span class="bullet">   -</span> åŒºå—å“ˆå¸Œè®¡ç®—</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> part3: Persistence and CLI <span class="code">`æŒä¹…åŒ–å’Œå‘½ä»¤è¡Œ`</span>  </span><br><span class="line">   [<span class="string">commit 8880dd2</span>](<span class="link">https://github.com/eatbreads/bitcoin_demo/tree/8880dd2</span>)</span><br><span class="line"><span class="bullet">   -</span> ä½¿ç”¨ sled å®ç°æ•°æ®æŒä¹…åŒ–</span><br><span class="line"><span class="bullet">   -</span> æ·»åŠ å‘½ä»¤è¡Œäº¤äº’ç•Œé¢</span><br><span class="line"><span class="bullet">   -</span> å®ç°åŒºå—é“¾éå†åŠŸèƒ½</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æŠ€å·§">ä½¿ç”¨æŠ€å·§</h2><ol><li><p><strong>ç‰ˆæœ¬æ ‡è®°</strong></p><ul><li>é‡è¦åŠŸèƒ½å®ŒæˆååŠæ—¶åˆ›å»ºtagæˆ–åˆ†æ”¯</li><li>ä½¿ç”¨æœ‰æ„ä¹‰çš„commit message</li><li>è®°å½•å…³é”®commitçš„å“ˆå¸Œå€¼</li></ul></li><li><p><strong>READMEç»„ç»‡</strong></p><ul><li>æŒ‰å¼€å‘é˜¶æ®µåˆ’åˆ†ç« èŠ‚</li><li>æ¯ä¸ªé˜¶æ®µæ ‡æ³¨å¯¹åº”çš„åˆ†æ”¯æˆ–commit</li><li>åˆ—å‡ºè¯¥é˜¶æ®µçš„ä¸»è¦åŠŸèƒ½ç‚¹</li></ul></li><li><p><strong>é“¾æ¥ç®¡ç†</strong></p><ul><li>ä½¿ç”¨ç›¸å¯¹è·¯å¾„è€Œéå®Œæ•´URL</li><li>ä¿æŒé“¾æ¥æ ¼å¼ç»Ÿä¸€</li><li>å®šæœŸæ£€æŸ¥é“¾æ¥æœ‰æ•ˆæ€§</li></ul></li></ol><p>è¿™ç§è·³è½¬åŠŸèƒ½ä¸ä»…æ–¹ä¾¿äº†é¡¹ç›®çš„ç®¡ç†å’Œç»´æŠ¤ï¼Œä¹Ÿä¸ºå…¶ä»–å¼€å‘è€…å­¦ä¹ å’Œå‚è€ƒé¡¹ç›®æä¾›äº†æ¸…æ™°çš„è·¯å¾„æŒ‡å¼•ã€‚</p>]]></content>
    
    
    <summary type="html">ä»‹ç»å¦‚ä½•åœ¨GitHubçš„READMEä¸­å®ç°ä¾¿æ·çš„ä»£ç ç‰ˆæœ¬è·³è½¬ï¼ŒåŒ…æ‹¬åˆ†æ”¯è·³è½¬å’Œcommitå“ˆå¸Œè·³è½¬ç­‰åŠŸèƒ½</summary>
    
    
    
    <category term="å¼€å‘æŠ€å·§" scheme="https://eatbreads.github.io/categories/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"/>
    
    
    <category term="GitHub" scheme="https://eatbreads.github.io/tags/GitHub/"/>
    
    <category term="Markdown" scheme="https://eatbreads.github.io/tags/Markdown/"/>
    
    <category term="å¼€å‘å·¥å…·" scheme="https://eatbreads.github.io/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>æ¯”ç‰¹å¸ç®€æ˜“å®ç°ä»£ç (ä¸‰)ï¼šäº¤æ˜“ç³»ç»Ÿä¸ä½™é¢æŸ¥è¯¢</title>
    <link href="https://eatbreads.github.io/posts/ea2afd4d.html"/>
    <id>https://eatbreads.github.io/posts/ea2afd4d.html</id>
    <published>2025-04-24T15:27:12.000Z</published>
    <updated>2025-04-24T15:36:47.759Z</updated>
    
    <content type="html"><![CDATA[<h1>æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿå®ç°</h1><h2 id="æ ¸å¿ƒæ•°æ®ç»“æ„">æ ¸å¿ƒæ•°æ®ç»“æ„</h2><h3 id="1-äº¤æ˜“ç»“æ„">1. äº¤æ˜“ç»“æ„</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Transaction</span> &#123;</span><br><span class="line">    id: <span class="type">String</span>,</span><br><span class="line">    vin: <span class="type">Vec</span>&lt;TXInput&gt;,</span><br><span class="line">    vout: <span class="type">Vec</span>&lt;TXOutput&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-äº¤æ˜“è¾“å‡º-TXOutput">2. äº¤æ˜“è¾“å‡º(TXOutput)</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TXOutput</span> &#123;</span><br><span class="line">    value: <span class="type">i64</span>,        <span class="comment">// ä»¥satoshiä¸ºå•ä½</span></span><br><span class="line">    script_pub_key: <span class="type">String</span>,  <span class="comment">// é”å®šè„šæœ¬(æ¥æ”¶æ–¹åœ°å€/å…¬é’¥)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼š</p><ul><li>valueè¡¨ç¤ºä»£é‡‘åˆ¸é‡‘é¢</li><li>script_pub_keyå®šä¹‰ä½¿ç”¨è§„åˆ™</li></ul></blockquote><h3 id="3-äº¤æ˜“è¾“å…¥-TXInput">3. äº¤æ˜“è¾“å…¥(TXInput)</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">TXInput</span> &#123;</span><br><span class="line">    txid: <span class="type">String</span>,      <span class="comment">// å¼•ç”¨çš„äº¤æ˜“ID</span></span><br><span class="line">    vout: <span class="type">i32</span>,         <span class="comment">// è¾“å‡ºç´¢å¼•</span></span><br><span class="line">    script_sig: <span class="type">String</span>, <span class="comment">// è§£é”è„šæœ¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼š</p><ul><li>voutæŒ‡æ˜ä½¿ç”¨å“ªä¸ªè¾“å‡ºä½œä¸ºæœ¬æ¬¡è¾“å…¥</li><li>æœªè¢«å¼•ç”¨çš„è¾“å‡ºå³ä¸ºä½™é¢</li></ul></blockquote><h2 id="åŠŸèƒ½å®ç°">åŠŸèƒ½å®ç°</h2><h3 id="1-åˆ›ä¸–äº¤æ˜“">1. åˆ›ä¸–äº¤æ˜“</h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Transaction</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new_coinbase</span>(to: <span class="type">String</span>, data: <span class="type">String</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Transaction &#123;</span><br><span class="line">            id: <span class="type">String</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">            vin: <span class="built_in">vec!</span>[TXInput &#123;</span><br><span class="line">                txid: <span class="type">String</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">                vout: -<span class="number">1</span>,</span><br><span class="line">                script_sig: data,</span><br><span class="line">            &#125;],</span><br><span class="line">            vout: <span class="built_in">vec!</span>[TXOutput &#123;</span><br><span class="line">                value: <span class="number">50</span> * <span class="number">100_000_000</span>, <span class="comment">// 50 BTC</span></span><br><span class="line">                script_pub_key: to,</span><br><span class="line">            &#125;],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ä½™é¢æŸ¥è¯¢å®ç°">2. ä½™é¢æŸ¥è¯¢å®ç°</h3><h4 id="æŸ¥æ‰¾æœªèŠ±è´¹äº¤æ˜“">æŸ¥æ‰¾æœªèŠ±è´¹äº¤æ˜“</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Blockchain</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">find_unspent_transactions</span>(&amp;<span class="keyword">self</span>, address: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;Transaction&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">unspent_txs</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">spent_outputs</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="variable">block</span> <span class="keyword">in</span> <span class="keyword">self</span>.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">            <span class="keyword">for</span> <span class="variable">tx</span> <span class="keyword">in</span> block.transactions &#123;</span><br><span class="line">                <span class="comment">// è®°å½•å·²èŠ±è´¹è¾“å‡º</span></span><br><span class="line">                <span class="keyword">for</span> <span class="variable">input</span> <span class="keyword">in</span> &amp;tx.vin &#123;</span><br><span class="line">                    <span class="keyword">if</span> input.<span class="title function_ invoke__">can_unlock_output_with</span>(address) &#123;</span><br><span class="line">                        spent_outputs.<span class="title function_ invoke__">insert</span>((input.txid.<span class="title function_ invoke__">clone</span>(), input.vout));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æŸ¥æ‰¾æœªèŠ±è´¹è¾“å‡º</span></span><br><span class="line">                <span class="keyword">for</span> (i, output) <span class="keyword">in</span> tx.vout.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">                    <span class="keyword">if</span> !spent_outputs.<span class="title function_ invoke__">contains_key</span>(&amp;(tx.id.<span class="title function_ invoke__">clone</span>(), i <span class="keyword">as</span> <span class="type">i32</span>))</span><br><span class="line">                        &amp;&amp; output.<span class="title function_ invoke__">can_be_unlocked_with</span>(address) &#123;</span><br><span class="line">                        unspent_txs.<span class="title function_ invoke__">push</span>(tx.<span class="title function_ invoke__">clone</span>());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        unspent_txs</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è®¡ç®—ä½™é¢">è®¡ç®—ä½™é¢</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">Blockchain</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_balance</span>(&amp;<span class="keyword">self</span>, address: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">i64</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">balance</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">utxos</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">find_unspent_transactions</span>(address);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> <span class="variable">tx</span> <span class="keyword">in</span> utxos &#123;</span><br><span class="line">            <span class="keyword">for</span> <span class="variable">output</span> <span class="keyword">in</span> tx.vout &#123;</span><br><span class="line">                <span class="keyword">if</span> output.<span class="title function_ invoke__">can_be_unlocked_with</span>(address) &#123;</span><br><span class="line">                    balance += output.value;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        balance</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½™é¢æŸ¥è¯¢æµç¨‹">ä½™é¢æŸ¥è¯¢æµç¨‹</h2><p><img src="https://cdn-a.markji.com/files/6809e95d6092fd692c50f89a_hd.png?e=1745509881827&amp;token=xX63b9jqTlDOcGmctt5K9254rV0LG8hS9BmDeFBy:NhrH-qO9mCnJGszcenPcMuhyC5I=" alt="å›¾ç‰‡1"></p><h3 id="1-åˆå§‹åŒ–">1. åˆå§‹åŒ–</h3><ul><li>åˆ›å»ºæœªèŠ±è´¹äº¤æ˜“åˆ‡ç‰‡</li><li>åˆ›å»ºå·²èŠ±è´¹è¾“å‡ºæ˜ å°„</li></ul><h3 id="2-éå†åŒºå—é“¾">2. éå†åŒºå—é“¾</h3><ul><li>è·å–åŒºå—é“¾è¿­ä»£å™¨</li><li>éå†æ¯ä¸ªåŒºå—ç›´åˆ°åˆ›ä¸–å—</li></ul><h3 id="3-å¤„ç†äº¤æ˜“">3. å¤„ç†äº¤æ˜“</h3><ul><li>éå†åŒºå—ä¸­æ‰€æœ‰äº¤æ˜“</li><li>è®°å½•å·²èŠ±è´¹è¾“å‡º</li><li>æŸ¥æ‰¾æœªèŠ±è´¹è¾“å‡º</li></ul><h3 id="4-éªŒè¯æ‰€æœ‰æƒ">4. éªŒè¯æ‰€æœ‰æƒ</h3><ul><li>æ£€æŸ¥è¾“å‡ºæ˜¯å¦èƒ½è¢«åœ°å€è§£é”</li><li>ç¡®è®¤è¾“å‡ºæœªè¢«åç»­äº¤æ˜“èŠ±è´¹</li></ul><h3 id="5-è®¡ç®—æœ€ç»ˆä½™é¢">5. è®¡ç®—æœ€ç»ˆä½™é¢</h3><ul><li>ç´¯åŠ æ‰€æœ‰æœªèŠ±è´¹è¾“å‡ºçš„å€¼</li><li>è¿”å›æ€»ä½™é¢</li></ul><h2 id="å®ç°ç‰¹ç‚¹">å®ç°ç‰¹ç‚¹</h2><ol><li>é‡‡ç”¨UTXOæ¨¡å‹</li><li>æ”¯æŒå¤šè¾“å…¥å¤šè¾“å‡º</li><li>å®ç°åŸºç¡€è„šæœ¬ç³»ç»Ÿ</li><li>æä¾›ä½™é¢æŸ¥è¯¢åŠŸèƒ½</li><li>æ”¯æŒæ–°äº¤æ˜“åˆ›å»º</li></ol>]]></content>
    
    
    <summary type="html">å®ç°æ¯”ç‰¹å¸çš„äº¤æ˜“ç³»ç»Ÿå’Œä½™é¢æŸ¥è¯¢åŠŸèƒ½ï¼ŒåŒ…æ‹¬äº¤æ˜“ç»“æ„è®¾è®¡ã€UTXOæ¨¡å‹å’Œä½™é¢è®¡ç®—</summary>
    
    
    
    <category term="åŒºå—é“¾æŠ€æœ¯" scheme="https://eatbreads.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="åŒºå—é“¾" scheme="https://eatbreads.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
    <category term="Rust" scheme="https://eatbreads.github.io/tags/Rust/"/>
    
    <category term="æ¯”ç‰¹å¸" scheme="https://eatbreads.github.io/tags/%E6%AF%94%E7%89%B9%E5%B8%81/"/>
    
  </entry>
  
</feed>
